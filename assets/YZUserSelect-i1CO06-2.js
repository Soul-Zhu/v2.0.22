import{d as H,c as K,m as g,o as W,p as k,w as X,a as i,b as v,e as w,r as u,g as r,h as c,n as C,l as B,F as S,j as b,v as O,q as N,k as $,s as F,t as f,x as ee}from"./main-BnXXyOo5.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"path-line"},ne=["onClick"],oe={key:0,class:"select-user"},se=["onClick"],le={class:"item-cont"},re={class:"item-cont-inner"},ce=["onClick"],ie={class:"item-cont"},ue={class:"item-cont-inner"},de={class:"check"},ve=H({__name:"YZUserSelect",props:{show:{type:Boolean,required:!0,default:!0},multiple:{type:Boolean,required:!1,default:!1},defaultUsers:{type:Array,required:!1,default:[]}},emits:["update:show","onSave"],setup(E,{emit:q}){const x=E,_=K(()=>x.show),U=q,A=()=>{l.value=[],s.value=[],U("update:show",!1),p()},D=()=>{U("onSave",l.value),l.value=[],m.value="",p(),U("update:show",!1)},m=g(""),s=g([]),d=g([]),l=g([]);W(async()=>{p()});const p=async()=>{const{data:e}=await k(N.getOrgs.url);d.value=e.map(a=>({type:"ou",...a})),s.value=[{name:"全部",ouid:"all",icon:!1,providerName:"",code:"",sid:"",level:""}]},V=async e=>{const a=N.getOrgChildren.url.toFetchUrl({params1:e.providerName,params2:e.ouid}),{data:o}=await k(a);d.value=o.map(n=>({type:"ou",...n})),L({name:e.text,icon:!1,ouid:e.ouid,providerName:e.providerName,code:e.code,sid:e.sid,level:e.ouLevel}),Y(e)},G=e=>{e.ouid==="all"?(p(),s.value=[{name:"全部",ouid:"all",icon:!1,providerName:"",code:"",sid:"",level:""}]):V({code:e.code,sid:e.sid,name:e.name,text:e.name,providerName:e.providerName,ouid:e.ouid,level:e.level})},I=e=>{const{account:a,displayName:o}=e;x.multiple?l.value.find(h=>h.account===a)||l.value.push({name:o,account:a}):(l.value=[],l.value.push({name:o,account:a}))},L=e=>{const a=s.value.find(n=>n.name===e.name),o=[];if(a){for(let n=0;n<s.value.length;n++)if(s.value[n].name===e.name){o.push({icon:!1,name:e.name,ouid:e.ouid,code:e.code,level:e.level,sid:e.sid,providerName:e.providerName});break}else o.push({icon:!0,name:s.value[n].name,ouid:s.value[n].ouid,code:s.value[n].code,level:s.value[n].level,sid:s.value[n].sid,providerName:s.value[n].providerName});s.value=o}else s.value.forEach(n=>{n.icon=!0}),s.value.push(e)},T=async()=>{if(!m.value)p();else{const{data:e}=await k(N.getSearchUser.url,{wd:m.value,page:1,start:0,limit:1e3});d.value=[],e.forEach(a=>{d.value.push({type:"user",...a})})}},J=()=>{p()},P=e=>l.value.find(o=>o.account===e)!==void 0,R=e=>{const a=l.value.findIndex(o=>o.account===e.account);a>-1&&l.value.splice(a,1)},Y=async e=>{const a=N.getOrgUsers.url.toFetchUrl({params1:e.providerName,params2:e.ouid}),{data:o}=await k(a);o&&o.length>0&&o.forEach(n=>{d.value.push({type:"user",...n})})};return X(()=>_.value,()=>{ee(()=>{_.value&&(l.value=JSON.parse(JSON.stringify(x.defaultUsers)))})}),(e,a)=>{const o=u("van-nav-bar"),n=u("van-search"),h=u("van-icon"),Z=u("van-tag"),j=u("van-cell"),M=u("van-cell-group"),Q=u("van-empty"),z=u("van-popup");return r(),i("div",null,[v(z,{show:_.value,"onUpdate:show":a[1]||(a[1]=t=>_.value=t),teleport:"body",position:"bottom",style:{height:"100%"}},{default:w(()=>[v(o,{title:e.$t("Form.Users"),"left-text":e.$t("Global.Cancle"),"right-text":e.$t("Global.Enter"),"left-arrow":"",onClickRight:D,onClickLeft:A},null,8,["title","left-text","right-text"]),c("div",null,[v(n,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=t=>m.value=t),placeholder:e.$t("Form.SearchUser"),onSearch:T,onClear:J,style:{padding:"0px",width:"95%",margin:"0px auto"}},null,8,["modelValue","placeholder"])]),c("div",te,[(r(!0),i(S,null,b(s.value,t=>(r(),i("div",{class:"li-div",key:t.name,onClick:y=>G(t)},[$(f(t.name)+" ",1),t.icon?(r(),F(h,{key:0,name:"arrow",style:{"margin-left":"-13px"}})):C("",!0)],8,ne))),128))]),l.value.length>0?(r(),i("div",oe,[(r(!0),i(S,null,b(l.value,(t,y)=>(r(),F(Z,{key:y,class:"user-tag",closeable:"",type:"primary",plain:"",onClose:pe=>R(t)},{default:w(()=>[$(f(t.name)+"("+f(t.account)+")",1)]),_:2},1032,["onClose"]))),128))])):C("",!0),v(M,null,{default:w(()=>[c("div",null,[(r(!0),i(S,null,b(d.value,t=>(r(),F(j,{key:t.text},{default:w(()=>[t.type==="ou"?(r(),i("div",{key:0,class:"item",onClick:y=>V(t)},[a[2]||(a[2]=c("i",{class:"fa fa-sitemap folder-icon"},null,-1)),c("div",le,[c("div",re,f(t.text),1)])],8,se)):C("",!0),t.type==="user"?(r(),i("div",{key:1,class:"item",onClick:y=>I(t)},[v(h,{class:"item-icon",name:"manager-o"}),c("div",ie,[c("div",ue,[$(f(t.shortName)+" ",1),c("div",de,[B(v(h,{name:"success",color:"#1889fa"},null,512),[[O,P(t.account)]])])])])],8,ce)):C("",!0)]),_:2},1024))),128))])]),_:1}),B(v(Q,{description:e.$t("Form.DepartNoUser")},null,8,["description"]),[[O,d.value.length<=0]])]),_:1},8,["show"])])}}}),fe=ae(ve,[["__scopeId","data-v-cacebd40"]]);export{fe as default};
