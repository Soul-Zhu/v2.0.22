import{d as j,c as V,m as c,q as Y,p as q,K as w,W as G,Z as L,s as U,e as z,i as K,u as l,r as y,g as C,h as m,a as Q,n as W,b as D,a1 as J}from"./main-BnXXyOo5.js";import{u as X,a as tt,b as et,_ as ot,c as st}from"./useDefaultRow-Bhv6lFSR.js";import{u as nt}from"./formStore-Byb73AL_.js";import{u as rt}from"./useProcessFormData-BB1RW82V.js";const at={class:"post-main"},it={class:"post-header"},ut={key:0,class:"post-form"},pt=j({__name:"YZHistoryFormRead",props:{token:{type:String,default:""},taskId:{type:String,default:""},formId:{type:String,required:!1,default:""},show:{type:Boolean,default:!1}},emits:["update:show"],setup(S,{emit:b}){const{parseSrcModel:k,parseSrcComponent:E}=X(),{createControlConfig:P}=tt(),{deleteExtendEventHandler:F,deleteFormFieldEvent:I}=st(),{createDefaultRow:x}=et(),{buildProcessFormData:A}=rt(),i=S,p=b,u=V({get(){return i.show&&N(i.token,i.taskId),i.show},set(t){p("update:show",t)}}),B=nt(),g=c([]),d=c({}),v=c(!1),R=c({});J("formData",d);const N=async(t,e)=>{if(t&&e){debugger;const s=Y.getHisotryReadInfo.url.toFetchUrl({params1:e}),{success:r,data:n,errorMessage:f}=await q(s,{readToken:t});if(!r){w(f,"danger");return}await O(n.form.formId,n.viewModel,n.processInstance)}},o=G(),O=async(t,e,s)=>{const r=await B.getFormDefined(t),n=k(r.src),f=E(n),{cfgs:_,plains:Z}=await P(f.definition,r,e,L.READ),h=A(e.data);d.value=h,R.value=x(h),g.value=_;const a=`${o.getCurrentFormId}_${t}`;T(s,a),o.setRuningFormData(a,d.value),o.setRuningFormId(a),o.setRunningDefaultCfg(a,_),Z.forEach($=>{o.addRunningPlainCfg(a,$)}),v.value=!0},T=(t,e)=>{if(o.setRuningInitaotr(e,t.initiatorAccount),o.setRuningOuId(e,t.ouid),o.setRuningMember(e,t.ownerPosition),o.setRuningSn(e,t.serialNum),o.setRuningStartTime(e,t.startTime),o.setRuningInitaotr(e,t.initiatorAccount),o.setRuningOwnerAccount(e,t.ownerAccount),t.ouid){const s=t.ouid.split("."),r=s[0],n=s[1];o.setRuningProviderName(e,r),o.setRuningOuId(e,n)}if(t.ownerPosition){const s=t.ownerPosition.split(".");o.setRuningMember(e,s[1])}},M=()=>{u.value=!1;const t=o.getCurrentFormId;if(t.indexOf("_")>0){H(),o.removeFormIdData(t);const e=t.split("_");e.pop();const s=e.join("_");o.setRuningFormId(s),p("update:show",!1)}else w("历史表单配置异常","danger")},H=()=>{I(!0),F(!0)};return(t,e)=>{const s=y("YZNav"),r=y("van-popup");return C(),U(r,{teleport:"body",show:l(u),"onUpdate:show":e[0]||(e[0]=n=>K(u)?u.value=n:null),style:{height:"100vh"},position:"bottom"},{default:z(()=>[m("div",at,[m("div",it,[D(s,{title:"历史表单",leftText:t.$t("Global.Back"),showBack:"",onOnLeftClick:M,rightText:""},null,8,["leftText"])]),l(v)?(C(),Q("div",ut,[D(ot,{cfg:l(g),formRow:l(R)},null,8,["cfg","formRow"])])):W("",!0),e[1]||(e[1]=m("div",{class:"post-button"},null,-1))])]),_:1},8,["show"])}}});export{pt as _};
