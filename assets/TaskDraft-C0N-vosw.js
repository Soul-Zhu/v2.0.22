import{d as $,m as r,$ as L,E as q,o as F,x as R,Q as w,aI as S,r as _,a as c,g as i,b as h,e as g,u as m,i as x,F as U,j as W,h as d,G as E,t as C,p as G,q as T,K as Q,aL as j,y as b,J as z,P as J}from"./main-BnXXyOo5.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O=["onClick"],A={class:"draft-card-title"},H={key:1,class:"icon fa fa-paper-plane-o"},X={class:"draft-card-title-text"},Y={class:"draft-card-time"},Z={class:"draft-card-desc"},ee=$({__name:"TaskDraft",setup(ae){const t=r(!1),u=r(!1),f=r(!1),n=L({page:1,start:0,limit:10,ProcessName:"",searchType:""}),P=r(0),o=r([]),N=q(),p=async()=>{t.value&&(t.value=!1,o.value.length=0),n.start=(n.page-1)*n.limit;const a={...n,...I.value},{success:s,errorMessage:l,data:k}=await G(T.getDraftTask.url,a);if(!s){Q(l,"danger");return}const{total:v,children:y}=k,e=y;P.value=v,a.page==1&&(o.value=[]),o.value.push(...e),(o.value.length>=v||e.length<=0)&&(f.value=!0),n.page+=1,u.value=!1},D=()=>{t.value=!0,f.value=!1,n.page=1,p()},B=a=>{N.push({path:"/post/"+a.ProcessId,query:{memberId:a.OwerPositionID,draftId:a.Id}})},M=a=>{j({title:b("Form.operateConfirm"),message:b("Work.ConfirmDeleteDraft")}).then(async()=>{const{Id:s}=a,l=await z(T.deleteDraft.url,[s]);l.success?D():J({type:"danger",message:l.errorMessage})})},I=r({});return F(()=>{p(),R(()=>{w.on("onTask_draft",a=>{I.value=a.value,n.page=1,t.value=!0,f.value=!1,o.value.length=0,p()})})}),S(()=>{w.off("onTask_draft")}),(a,s)=>{const l=_("van-button"),k=_("van-swipe-cell"),v=_("van-list"),y=_("van-pull-refresh");return i(),c("div",null,[h(y,{modelValue:m(t),"onUpdate:modelValue":s[1]||(s[1]=e=>x(t)?t.value=e:null),onRefresh:D},{default:g(()=>[h(v,{loading:m(u),"onUpdate:loading":s[0]||(s[0]=e=>x(u)?u.value=e:null),finished:m(f),"immediate-check":!1,"finished-text":a.$t("Work.NoMore"),onLoad:p},{default:g(()=>[(i(!0),c(U,null,W(m(o),e=>(i(),c("div",{key:e.ProcessId},[h(k,null,{right:g(()=>[h(l,{square:"",text:a.$t("Work.Delete"),type:"danger",class:"delete-button",onClick:V=>M(e)},null,8,["text","onClick"])]),default:g(()=>[d("div",{class:"draft-card",onClick:V=>B(e)},[d("div",A,[e.ProcessIcon?(i(),c("i",{key:0,class:E(e.ProcessIcon)},null,2)):(i(),c("i",H)),d("span",X,C(e.Name),1)]),d("div",Y,C(e.CreatedTime),1),d("div",Z,C(e.Description),1)],8,O)]),_:2},1024)]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])}}}),ne=K(ee,[["__scopeId","data-v-0e7b1960"]]);export{ne as default};
