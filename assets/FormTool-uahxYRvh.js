import{J as Y,q as l,K as u,p as N,ad as I,W as Z,d as y,m as D,c as k,o as w,Z as f,y as s,a as F,g as d,F as B,j as E,u as S,s as T,a5 as U}from"./main-BnXXyOo5.js";import{u as _}from"./useFormEnv-VwQXjqJl.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A=I();Z();const z=()=>({getProcessInfoDefined:async r=>{const t=l.getProcessInfo.url.toFetchUrl({params1:r}),{success:a,data:e,errorMessage:n}=await N(t);return a?e:(u(n,"danger"),null)},getFormDefined:async r=>{const{success:t,data:a,errorMessage:e}=await N(l.getFormDefined.url.toFetchUrl({params1:r}));if(!t)throw new Error(e);if(a.property.localizationSetting&&a.property.localizationSetting.enable){const{languages:n}=a.property.localizationSetting;A.setFormLanguage(n)}return a},getPositionDefined:async(r,t,a)=>{t||(t="-1");const{data:e,success:n,errorMessage:o}=await Y(l.getProcessDefined.url.toFetchUrl({params1:r}),{draftId:t,owner:a});return n?e:(u(o,"danger"),null)},getProcessReadInfo:async r=>{const t=l.getReadTask.url.toFetchUrl({params1:r}),{success:a,data:e,errorMessage:n}=await N(t);return a?e:(u(n,"danger"),null)},getProcessRequestInfo:async r=>{const t=l.getRequestTask.url.toFetchUrl({params1:r}),{success:a,data:e,errorMessage:n}=await N(t);return a?e:(u(n,"danger"),null)},getProcessInformInfo:async r=>{const t=l.getProcessInfo.url.toFetchUrl({params1:r}),{success:a,data:e,errorMessage:n}=await N(t);return a?e:(u(n,"danger"),null)},getPositioniDefindName:async(r,t,a)=>{t||(t="-1");const{data:e,success:n,errorMessage:o}=await Y(l.getProcessDefindName.url.toFetchUrl({params1:r}),{draftId:t,owner:a});return n?e:(u(o,"danger"),null)}}),C={class:"form-tool van-safe-area-bottom"},q=y({__name:"FormTool",props:{env:{}},setup(b){const p=Z(),m=D([]),g=k(()=>p.getCurrentFormId),{getFormEnv:R}=_();w(()=>{const e=R();e===f.POST?v():e===f.PROCESS?P():e===f.NOFITY?t():(e===f.READ||e===f.REQUEST)&&a(e)});const v=async()=>{const e=p.getRuningActions(g.value);e.length>0&&e.forEach(n=>{m.value.push({btnName:n.actionName,componentName:"YZSubmitBtn",action:n})}),m.value.push({btnName:"保存草稿",componentName:"YZDraft",icon:"edit"})},P=()=>{const e=p.getRuningProcessInfoDefined(g.value);if(!e){u("无法获取流程信息","danger");return}const n=e.actions,o=[];n.length>0&&n.forEach(c=>{o.push({btnName:c.actionName,componentName:"YZAgreeBtn",action:c,icon:"success"})}),o.push({btnName:"保存",componentName:"YZSave",icon:"sign"});const i=e.permisions;o.push(...r(i));const h=[];for(let c=0;c<o.length;c++)c>=3?h.push({btnName:o[c].btnName,action:o[c].action,componentName:o[c].componentName,icon:o[c].icon,others:[]}):m.value.push({btnName:o[c].btnName,componentName:o[c].componentName,action:o[c].action,icon:o[c].icon});h.length>0&&m.value.push({btnName:s("Form.More"),componentName:"YZMore",others:h,icon:"more-o"})},r=e=>{const n=[];return e.RecedeRestart&&n.push({btnName:s("Form.RecedeRestart"),componentName:"YZReturnStart",icon:"revoke"}),e.Reject&&n.push({btnName:s("Form.Refuse"),componentName:"YZReject",icon:"cross"}),e.Inform&&n.push({btnName:s("Form.Notify"),icon:"chat-o",componentName:"YZInform"}),e.Transfer&&n.push({btnName:s("Form.Entrust"),componentName:"YZTransfer",icon:"exchange"}),e.Abort&&n.push({btnName:s("Form.Cancel"),componentName:"YZAbort",icon:"delete-o"}),e.RecedeBack&&n.push({btnName:s("Form.RecedeBack"),componentName:"YZRecedeBack",icon:"records-o"}),n.push({btnName:s("Form.changeFiled"),componentName:"YZChangeField",icon:"edit"}),n},t=()=>{m.value=[{btnName:s("Form.Read"),componentName:"YZRead"},{btnName:s("Form.Notify"),componentName:"YZInform",icon:"chat-o"},{btnName:s("Form.changeFiled"),componentName:"YZChangeField",icon:"edit"}]},a=e=>{let n=null;if(e===f.READ?n=p.getProcessReadDefined(g.value):n=p.getProcessRequestDefined(g.value),!n){u(s("Work.NoDefind"),"danger");return}const o=[],i=n.permisions;b.env===f.READ?(n.processInstance.status==="running"&&o.push({btnName:s("Form.Retrieve"),componentName:"YZPickBack",icon:"revoke"}),o.push({btnName:s("Form.Notify"),componentName:"YZInform",icon:"chat-o"})):i&&(i.Abort&&o.push({btnName:s("Form.Cancel"),componentName:"YZAbort",icon:"delete-o"}),i.Inform&&o.push({btnName:s("Form.Notify"),componentName:"YZInform",icon:"chat-o"}),i.PickBackRestart&&o.push({btnName:s("Form.Retrieve"),componentName:"YZPickBack",icon:"revoke"}),i.Reminder&&o.push({btnName:s("Form.Urging"),componentName:"YZReminder",icon:"underway-o"})),o.push({btnName:s("Form.changeFiled"),componentName:"YZChangeField",icon:"edit"}),m.value=o};return(e,n)=>(d(),F("div",C,[(d(!0),F(B,null,E(S(m),(o,i)=>(d(),F("div",{class:"form-tool-render",key:i},[(d(),T(U(o.componentName),{btnName:o.btnName,action:o.action,icon:o.icon,componentName:o.componentName,others:o.others,env:e.env},null,8,["btnName","action","icon","componentName","others","env"]))]))),128))]))}}),O=M(q,[["__scopeId","data-v-e46c5928"]]);export{O as F,z as u};
