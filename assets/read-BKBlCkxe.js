import{A as W,m as n,E as Y,c as $,D as X,o as q,aI as J,W as K,X as Q,Z as V,d as ee,w as oe,a as y,g,h as B,b as _,s as T,n as h,e as x,u as t,r as L,aM as se,i as te,a1 as O}from"./main-BnXXyOo5.js";import{c as ne,u as re,a as ae,b as ce,_ as ie}from"./useDefaultRow-Bhv6lFSR.js";import{a as me}from"./app.hook-BvqEBUQR.js";import{u as ue,F as le}from"./FormTool-uahxYRvh.js";import{u as de}from"./useProcessFormData-BB1RW82V.js";import{R as fe}from"./RecordPopup-DKCYEjJ4.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./LoginFactory-C2TRmDIo.js";import"./wecom.prod-DVLinVsr.js";import"./dynamic-import-helper-BheWnx7M.js";import"./useInitFieldState-EKN-2KHT.js";import"./useFormEnv-VwQXjqJl.js";const{deleteEventHandler:f,deleteFormFieldEvent:ve,deleteExtendEventHandler:ge}=ne(),{getProcessReadInfo:_e,getFormDefined:Re}=ue(),we=X(),o=K(),Ie=()=>{const S=W(),R=n(""),r=n([]),a=n({}),i=n(!1),w=Y(),p=n(""),m=n(""),u=n({}),{parseSrcModel:I,parseSrcComponent:l}=re(),{createControlConfig:d}=ae(),{createDefaultRow:C}=ce(),{buildProcessFormData:F}=de(),k=$(()=>we.getApp),P=async()=>{const v=Q(),{taskId:E}=S.params;m.value=String(E);const e=await _e(String(E));if(!e)return;const s=e.form.formId;o.setRuningFormId(s),o.setProcessReadDefined(s,e),p.value=e.processName,R.value=e.processVersion;const N=await Re(e.form.formId);if(o.setRuningSn(s,e.processInstance.serialNum),o.setRuningStartTime(s,e.processInstance.startTime),o.setRuningInitaotr(s,e.processInstance.initiatorAccount),o.setRuningOwnerAccount(s,e.processInstance.ownerAccount),e.processInstance.ouid){const c=e.processInstance.ouid.split("."),G=c[0],U=c[1];o.setRuningProviderName(s,G),o.setRuningOuId(s,U)}if(e.processInstance.ownerPosition){const c=e.processInstance.ownerPosition.split(".");o.setRuningMember(s,c[1])}const j=I(N.src),D=l(j);o.setRuningFunctions(s,D.funcs),o.setRuningValidators(s,D.validators);const{cfgs:A,cfgForm:Se,plains:z}=await d(D.definition,N,e.viewModel,V.READ),M=F(e.viewModel.data);u.value=C(M),a.value=M,r.value=A,o.setRunningDefaultCfg(s,A),o.setRuningFormData(s,a),z.forEach(c=>{o.addRunningPlainCfg(s,c)}),sessionStorage.setItem("env","read"),i.value=!0,v&&v.remove()},H=()=>{me(w)},b=n(!1),Z=()=>{b.value=!0};return q(async()=>{await P()}),J(()=>{const v=o.getCurrentFormId;ve(!0),ge(!0),f("onForm_MoreClose",!0),f("onForm_Agreen",!0),f("onForm_ProcessRead",!0),f("onForm_PostSubmit",!0),f("onForm_DraftSubmit",!0),o.removeFormIdData(v)}),{init:P,formData:a,fields:r,render:i,onLeftClick:H,processName:p,onMoreClick:Z,moreShow:b,app:k,formRow:u}},Ce={class:"post-main"},Fe={class:"post-header"},ke={key:0,class:"post-form"},De={class:"post-button"},he=ee({__name:"read",setup(S){const{onLeftClick:R,render:r,fields:a,formData:i,processName:w,onMoreClick:p,moreShow:m,app:u,formRow:I}=Ie();return O("formData",i),O("formField",a),oe(i,(l,d)=>{window.formDataBase=l},{deep:!0}),(l,d)=>{const C=L("van-icon"),F=L("YZNav");return g(),y("div",Ce,[B("div",Fe,[_(F,{title:t(w),leftText:l.$t(t(u)?"Global.Close":"Global.Back"),showBack:!t(u),onOnLeftClick:t(R),rightText:""},{right:x(()=>[_(C,{name:"more-o",size:"22",onClick:t(p)},null,8,["onClick"])]),_:1},8,["title","leftText","showBack","onOnLeftClick"])]),_(se,{name:"van-slide-left"},{default:x(()=>[t(r)?(g(),y("div",ke,[_(ie,{cfg:t(a),ref:"formRef","form-row":t(I)},null,8,["cfg","form-row"])])):h("",!0)]),_:1}),B("div",De,[t(r)?(g(),T(le,{key:0,env:t(V).READ},null,8,["env"])):h("",!0)]),t(r)?(g(),T(fe,{key:0,"more-show":t(m),"onUpdate:moreShow":d[0]||(d[0]=k=>te(m)?m.value=k:null)},null,8,["more-show"])):h("",!0)])}}}),Ve=pe(he,[["__scopeId","data-v-83f99a73"]]);export{Ve as default};
