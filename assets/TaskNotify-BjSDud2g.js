import{d as z,m as l,$ as W,B as q,o as E,x as J,Q as V,aI as K,r as _,aG as Y,a as k,g as p,b as f,n as B,e as i,u as n,i as D,F as H,j as X,l as Z,s as ee,aQ as se,av as ae,h as T,t as g,k as R,p as te,q as $,K as oe,aL as ne,y as F,J as le,P as re}from"./main-BnXXyOo5.js";import{T as ce}from"./TaskCard-DN6TrCgP.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"notify-work-wrap"},de={style:{"padding-left":"10px"}},pe={key:0,class:"step-name"},fe={class:"step-item"},ve={class:"status-div"},me={key:0,class:"select-check-btn"},he=z({__name:"TaskNotify",setup(_e){const r=l(!1),y=l(!1),I=l(!1),c=W({page:1,start:0,limit:10,ProcessName:"",searchType:""}),L=l(0),u=l([]),M=q(),C=async()=>{r.value&&(r.value=!1,u.value.length=0),c.start=(c.page-1)*c.limit;const e={...c,...x.value},{success:s,errorMessage:t,data:d}=await te($.getNotifyTask.url,e);if(!s){oe(t,"danger");return}const{total:m,children:N}=d;M.setInformCount(m);const h=N;L.value=m,e.page==1&&(u.value=[]),u.value.push(...h),(u.value.length>=m||h.length<=0)&&(I.value=!0),c.page+=1,y.value=!1},A=e=>(e&&e.includes("icon-")&&!e.includes("iconfont")&&(e="iconfont "+e),e),U=e=>({ProcessId:e.ProcessId,ProcessName:e.ProcessName,ProcessVersion:e.ProcessVersion,ProcessIcon:A(e.ProcessIcon),SerialNum:e.SerialNum,CreateAt:e.CreateAt,Description:e.Description,OwnerDisplayName:e.OwnerDisplayName,TaskID:e.TaskID,StepID:e.StepID}),b=()=>{r.value=!0,c.page=1,C()},x=l({});E(()=>{C(),J(()=>{V.on("onTask_notify",e=>{x.value=e.value,c.page=1,r.value=!0,I.value=!1,u.value.length=0,C()})})}),K(()=>{V.off("onTask_notify")});const v=l(!1),o=l([]),G=()=>{v.value=!0},w=e=>{let s=o.value.findIndex(t=>t==e.StepID);s>=0?o.value.splice(s,1):o.value.push(e.StepID)},O=()=>{ne({title:F("Form.operateConfirm"),message:F("Form.slectConfirm")}).then(async()=>{const e={items:o.value.map(t=>({ID:t,StepID:t}))},s=await le($.batchApprove.url,e,{Method:"BatchApprove"});if(s.success){let t=s.data.processedItems.map(d=>`${d.SerialNum}ï¼š${d.Result}`).join(`
`);re({type:"success",message:t}),P(),b()}}).catch(()=>{})},Q=e=>v.value?(w(e),!1):!0,P=()=>{v.value=!1,o.value=[]};return(e,s)=>{const t=_("van-checkbox"),d=_("van-checkbox-group"),m=_("van-list"),N=_("van-pull-refresh"),h=_("van-button"),j=Y("longpress");return p(),k("div",ue,[f(N,{modelValue:n(r),"onUpdate:modelValue":s[2]||(s[2]=a=>D(r)?r.value=a:null),onRefresh:b,style:{flex:"1","overflow-y":"auto"}},{default:i(()=>[f(m,{loading:n(y),"onUpdate:loading":s[1]||(s[1]=a=>D(y)?y.value=a:null),finished:n(I),"immediate-check":!1,"finished-text":e.$t("Work.NoMore"),onLoad:C},{default:i(()=>[(p(!0),k(H,null,X(n(u),a=>(p(),k("div",{key:a.ProcessId},[Z((p(),ee(ce,{process:U(a),"before-click":Q,"task-type":n(se).NOTIFY},ae({default:i(()=>[a.Recipient?(p(),k("div",pe,[T("div",fe,g(a.Recipient.displayName)+"("+g(a.Recipient.account)+") ",1),T("div",ve,g(a.NodeName),1)])):B("",!0)]),_:2},[n(v)?{name:"checkbox",fn:i(()=>[T("div",de,[f(d,{modelValue:n(o),"onUpdate:modelValue":s[0]||(s[0]=S=>D(o)?o.value=S:null),onClick:S=>w(a)},{default:i(()=>[f(t,{name:a.StepID},null,8,["name"])]),_:2},1032,["modelValue","onClick"])])]),key:"0"}:void 0]),1032,["process","task-type"])),[[j,G]])]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"]),n(v)?(p(),k("div",me,[f(h,{size:"small",type:"primary",disabled:n(o).length==0,onClick:O},{default:i(()=>[R(g(e.$t("Form.Read")),1)]),_:1},8,["disabled"]),f(h,{size:"small",type:"danger",onClick:P},{default:i(()=>[R(g(e.$t("Global.Cancle")),1)]),_:1})])):B("",!0)])}}}),Ce=ie(he,[["__scopeId","data-v-4ae675a6"]]);export{Ce as default};
