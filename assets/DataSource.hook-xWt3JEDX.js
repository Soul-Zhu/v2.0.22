import{i as R,aD as p,J as j,aE as Y,H as s,q as i,a2 as o}from"./main-BnXXyOo5.js";import{u as Z}from"./formStore-Byb73AL_.js";const q=()=>{const S=Z(),g=e=>{var r;let a=null;if(!e)return a;switch(e.public&&(e.ds.type=s.common),(r=e.ds)==null?void 0:r.type){case s.esb:a=w(e);break;case s.table:a=I(e);break;case s.form:a=N(e);break;case s.common:a=P(e);break;case s.app:a=C(e);break}return a},I=e=>({displayField:e.displayField??"",valueField:e.valueField??e.filterParam??"",type:e.ds.type,tableName:e.ds.tableName,dataSourceId:e.ds.dataSourceId,filter:f(e.ds.filter),map:m(e.$map),orderBy:e.ds.orderBy??"",viewColumns:[]}),w=e=>({displayField:e.displayField??"",valueField:e.valueField??e.filterParam??"",type:e.ds.type,tableName:"",dataSourceId:e.ds.esbId,filter:f(e.ds.filter),map:m(e.$map),orderBy:e.ds.orderBy??"",viewColumns:[]}),P=e=>({displayField:e.displayField,valueField:e.valueField??e.filterParam??"",type:e.ds.type,tableName:e.ds.tableName,dataSourceId:e.ds.dataSourceId,filter:f(e.ds.filter),map:m(e.$map),orderBy:e.ds.orderBy??"",viewColumns:[]}),C=e=>({displayField:e.displayField,valueField:e.valueField??e.filterParam??"",type:e.ds.type,tableName:e.ds.tableName,dataSourceId:e.ds.dataSourceId,filter:f(e.ds.filter),map:m(e.$map),orderBy:e.ds.orderBy??"",viewColumns:[]}),N=e=>({displayField:e.displayField,valueField:e.valueField??e.filterParam??"",type:e.ds.type,tableName:e.ds.formTable,dataSourceId:e.ds.formId,filter:f(e.ds.filter),map:m(e.$map),orderBy:e.ds.orderBy??"",viewColumns:[]}),f=e=>{const a={};return e&&Object.keys(e).forEach(r=>{const t=e[r].value;a[r]={op:e[r].op,value:t===void 0?e[r].field:t,type:t===void 0?"field":"const"}}),a},m=e=>{if(!e)return{};const a={};return Object.keys(e).forEach(r=>{a[r]=e[r]}),a},E=(e,a)=>{if(!e)return"";const{dataSourceId:r,tableName:t,type:l}=e;let u="";switch(l){case s.table:u=a?i.getTableDatSource.url.toFetchUrl({params1:r,params2:t}):i.getDataBowerTablePage.url.toFetchUrl({params1:r,params2:t});break;case s.esb:u=a?i.getEsbDataSourceNoPage.url.toFetchUrl({params1:e.dataSourceId}):i.getDataBowerEsbPage.url.toFetchUrl({params1:r});break;case s.form:u=a?i.getFormDataSource.url.toFetchUrl({params1:e.dataSourceId,params2:e.tableName}):i.getDataBowerFormPage.url.toFetchUrl({params1:r,params2:t});break}return u},T=(e,a,r)=>{if(!e)return btoa("[]");const t=[];a&&t.push(`${p(e.valueField)}`),r&&t.push(`${p(e.displayField)}`),Object.keys(e.map).forEach(u=>{t.push(`${Y(u)}`)});const l=`[${t.join(",")}]`;return btoa(l)},$=(e,a)=>{const r=e.rowPId;return h(r,a)},h=(e,a)=>{if(e===void 0)return[];const r=a.filter(l=>l.rowId===e),t=[];for(const l of r){if(l.ctype===o.YZGrid||l.ctype===o.YZFormtitle||l.ctype===o.YZButton||l.ctype===o.YZDesc||l.ctype===o.YZDatabrowserbtn||l.ctype===o.YZSegmentbar)continue;t.find(c=>c.uuid===l.uuid)||t.push(l);const n=h(l.rowPId,a);n.length>0&&n.forEach(c=>{t.find(F=>F.uuid===c.uuid)||t.push(c)})}return t},B=(e,a,r)=>{if(!e||!e.filter)return"";const t=R(a)?a.value:a,l=["{"];Object.keys(e.filter).forEach(n=>{const c=e.filter[n];let d=c.value;if(t[d]!==void 0&&(d=t[d]),d.includes(".")){const[F,M]=d.split("."),v=S.getPlianFields;if(F===r.table){d=M;const b=v.find(y=>y.rowId===r.rowId);b&&(d=b.getValue())}else{const b=$(r,v);if(b.length>0){const y=b.find(D=>D.fullKey===d);y&&(d=y.getValue())}}}l.push(`${p(n)}:{"op":"${c.op}","value":${p(d)}}`),l.push(",")}),l.length!==1&&l.pop(),l.push("}");const u=l.join("");return btoa(u)},U=e=>e?k(e.orderBy):"",k=e=>{const r=new TextEncoder().encode(e);return btoa(String.fromCharCode.apply(null,r))};return{buildRunTimeDsModel:g,buildDataSourceRequestUrl:E,buildDataSourceColumn:T,getDataSourceData:async(e,a)=>{const{data:r,success:t,errorMessage:l}=await j(e,a);return t?r:null},buildDataSourceFilter:B,buildDataSourceO:U}};export{q as u};
