import{d as Z,L as U,m as p,M as I,o as L,x as P,w as Q,Q as v,a as T,l as j,v as z,u as l,h as A,b as y,e as k,i as M,r as C,G as J,J as X,K as S,q as N,g as E,s as ee,n as ae,k as se,t as le,I as te,p as oe}from"./main-BnXXyOo5.js";import{_ as ne}from"./YZChangeFieldTag.vue_vue_type_style_index_0_lang-CU_sMXjx.js";import ue from"./YZUserSelect-i1CO06-2.js";import{u as re}from"./formWatch-KqHO0hI-.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./encodeext-DBC3bVZy.js";import"./useFormEnv-VwQXjqJl.js";import"./useInitFieldState-EKN-2KHT.js";const ie=Z({__name:"YZUser",props:U({cfg:{},formRow:{}},{modelValue:{type:String},modelModifiers:{}}),emits:U(["update:field"],["update:modelValue"]),setup(w,{emit:K}){const h=p([]),o=p(),i=I(w,"modelValue"),c=w,a=p(c.cfg),_=async e=>{const{data:s,success:t,errorMessage:u}=await X(N.getUsersSimple.url,{accounts:[e]});return t?s&&s.length>0?s[0]:null:(S(u,"danger"),null)},{WatchChageExpress:B,WatchSelfExpress:R}=re();L(()=>{H(),P(async()=>{if(i.value){const e=await _(i.value);e&&(o.value=e.text)}R(a.value,c.formRow,e=>{},e=>{a.value.hidden=e,f("update:field",a.value)},e=>{a.value.disabled=e,f("update:field",a.value)},e=>{a.value.hidden=e,f("update:field",a.value)})})}),Q(()=>i.value,async(e,s)=>{if(B(c.cfg,e,c.formRow),e){const t=await _(e);t&&(o.value=t.text)}});const g=p(!1),q=()=>{c.cfg.disabled||(g.value=!0,h.value=[],o.value&&i.value&&h.value.push({name:String(o.value),account:i.value}))},D=async e=>{if(e&&e.length>0){i.value=e[0].account,o.value=e[0].name;const s=await _(e[0].account);b(s)}else i.value="",o.value="",b(null)},{setFormValue:V}=te(),b=e=>{const s=c.cfg.$map;if(!s)return;const t=Object.keys(s);if(t.length<=0)return;if(!e){t.forEach(r=>{const m=s[r];V(c.cfg,m,"")});return}const u=N.getUserMapData.url.toFetchUrl({params1:e.account});oe(u).then(r=>{const{success:m,data:n,errorMessage:O}=r;if(!m){S(O,"danger");return}n&&t.forEach(x=>{const W=s[x];let d=x;if(d.indexOf(".")<0)d=`user.${d}`;else switch(d.split(".")[0]){case"extAttrs":d=`user.${d}`;break;case"pos":d=d.replace("pos.",""),d=`defaultPosition.${d}`;break}const Y=F(n,d);V(c.cfg,W,Y)})})},F=(e,s)=>{const t=s.split(".");let u=e;for(const r of t)u=u[r];return u??""},G=()=>{o.value="",i.value="",b(null)},f=K,$=p(""),H=()=>{const e=a.value,s=`setDisabled_${e.uuid}_${e.fullKey}`,t=`setHidden_${e.uuid}_${e.fullKey}`,u=`setColumnHidden_${e.uuid}_${e.fullKey}`,r=`setRules_${e.uuid}_${e.fullKey}`,m=`setClose_${e.uuid}`;v.on(s,n=>{a.value.disabled=n,f("update:field",a.value)}),v.on(t,n=>{a.value.hidden=n,f("update:field",a.value)}),v.on(u,n=>{a.value.hidden=n,f("update:field",a.value)}),v.on(r,n=>{a.value.rules=[n],f("update:field",a.value)}),v.on(m,n=>{$.value=n})};return(e,s)=>{const t=C("van-tag"),u=C("van-field");return E(),T("div",{class:J(l($))},[j(A("div",null,[y(u,{readonly:"",name:l(a).bindModel,label:l(a).fieldLabel,placeholder:l(a).placeholder,required:l(a).required,disabled:l(a).disabled,rules:l(a).rules,clickable:"","is-link":!l(a).disabled,modelValue:l(o),"onUpdate:modelValue":s[0]||(s[0]=r=>M(o)?o.value=r:null),onClick:q},{input:k(()=>[l(o)?(E(),ee(t,{key:0,closeable:!l(a).disabled,class:"user-tag",type:"primary",plain:"",onClose:G},{default:k(()=>[se(le(l(o)),1)]),_:1},8,["closeable"])):ae("",!0)]),button:k(()=>[y(ne,{field:l(a)},null,8,["field"])]),_:1},8,["name","label","placeholder","required","disabled","rules","is-link","modelValue"]),y(ue,{show:l(g),"onUpdate:show":s[1]||(s[1]=r=>M(g)?g.value=r:null),defaultUsers:l(h),onOnSave:D},null,8,["show","defaultUsers"])],512),[[z,!l(a).hidden]])],2)}}}),ye=de(ie,[["__scopeId","data-v-0e25724a"]]);export{ye as default};
