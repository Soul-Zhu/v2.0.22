import{ao as z,ap as K,d as Y,m as U,w as Z,C as F,a as D,b as C,e as P,i as B,u as S,r as k,g as O,h as V,n as T,k as J,t as N,K as W}from"./main-BnXXyOo5.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";var $={exports:{}};(function(x,j){(function(w,y){x.exports=y()})(z,function(){function w(e){var d=[];return e.AMapUI&&d.push(y(e.AMapUI)),e.Loca&&d.push(G(e.Loca)),Promise.all(d)}function y(e){return new Promise(function(d,n){var s=[];if(e.plugins)for(var l=0;l<e.plugins.length;l+=1)t.AMapUI.plugins.indexOf(e.plugins[l])==-1&&s.push(e.plugins[l]);if(i.AMapUI===o.failed)n("前次请求 AMapUI 失败");else if(i.AMapUI===o.notload){i.AMapUI=o.loading,t.AMapUI.version=e.version||t.AMapUI.version,l=t.AMapUI.version;var M=document.body||document.head,f=document.createElement("script");f.type="text/javascript",f.src="https://webapi.amap.com/ui/"+l+"/main.js",f.onerror=function(u){i.AMapUI=o.failed,n("请求 AMapUI 失败")},f.onload=function(){if(i.AMapUI=o.loaded,s.length)window.AMapUI.loadUI(s,function(){for(var u=0,I=s.length;u<I;u++){var a=s[u].split("/").slice(-1)[0];window.AMapUI[a]=arguments[u]}for(d();m.AMapUI.length;)m.AMapUI.splice(0,1)[0]()});else for(d();m.AMapUI.length;)m.AMapUI.splice(0,1)[0]()},M.appendChild(f)}else i.AMapUI===o.loaded?e.version&&e.version!==t.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.length?window.AMapUI.loadUI(s,function(){for(var u=0,I=s.length;u<I;u++){var a=s[u].split("/").slice(-1)[0];window.AMapUI[a]=arguments[u]}d()}):d():e.version&&e.version!==t.AMapUI.version?n("不允许多个版本 AMapUI 混用"):m.AMapUI.push(function(u){u?n(u):s.length?window.AMapUI.loadUI(s,function(){for(var I=0,a=s.length;I<a;I++){var c=s[I].split("/").slice(-1)[0];window.AMapUI[c]=arguments[I]}d()}):d()})})}function G(e){return new Promise(function(d,n){if(i.Loca===o.failed)n("前次请求 Loca 失败");else if(i.Loca===o.notload){i.Loca=o.loading,t.Loca.version=e.version||t.Loca.version;var s=t.Loca.version,l=t.AMap.version.startsWith("2"),M=s.startsWith("2");if(l&&!M||!l&&M)n("JSAPI 与 Loca 版本不对应！！");else{l=t.key,M=document.body||document.head;var f=document.createElement("script");f.type="text/javascript",f.src="https://webapi.amap.com/loca?v="+s+"&key="+l,f.onerror=function(u){i.Loca=o.failed,n("请求 AMapUI 失败")},f.onload=function(){for(i.Loca=o.loaded,d();m.Loca.length;)m.Loca.splice(0,1)[0]()},M.appendChild(f)}}else i.Loca===o.loaded?e.version&&e.version!==t.Loca.version?n("不允许多个版本 Loca 混用"):d():e.version&&e.version!==t.Loca.version?n("不允许多个版本 Loca 混用"):m.Loca.push(function(u){u?n(u):n()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var o;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(o||(o={}));var t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},i={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},m={AMapUI:[],Loca:[]},r=[],E=function(e){typeof e=="function"&&(i.AMap===o.loaded?e(window.AMap):r.push(e))};return{load:function(e){return new Promise(function(d,n){if(i.AMap==o.failed)n("");else if(i.AMap==o.notload){var s=e.key,l=e.version,M=e.plugins;s?(window.AMap&&location.host!=="lbs.amap.com"&&n("禁止多种API加载方式混用"),t.key=s,t.AMap.version=l||t.AMap.version,t.AMap.plugins=M||t.AMap.plugins,i.AMap=o.loading,l=document.body||document.head,window.___onAPILoaded=function(u){if(delete window.___onAPILoaded,u)i.AMap=o.failed,n(u);else for(i.AMap=o.loaded,w(e).then(function(){d(window.AMap)}).catch(n);r.length;)r.splice(0,1)[0]()},M=document.createElement("script"),M.type="text/javascript",M.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+t.AMap.version+"&key="+s+"&plugin="+t.AMap.plugins.join(","),M.onerror=function(u){i.AMap=o.failed,n(u)},l.appendChild(M)):n("请填写key")}else if(i.AMap==o.loaded)if(e.key&&e.key!==t.key)n("多个不一致的 key");else if(e.version&&e.version!==t.AMap.version)n("不允许多个版本 JSAPI 混用");else{if(s=[],e.plugins)for(l=0;l<e.plugins.length;l+=1)t.AMap.plugins.indexOf(e.plugins[l])==-1&&s.push(e.plugins[l]);s.length?window.AMap.plugin(s,function(){w(e).then(function(){d(window.AMap)}).catch(n)}):w(e).then(function(){d(window.AMap)}).catch(n)}else if(e.key&&e.key!==t.key)n("多个不一致的 key");else if(e.version&&e.version!==t.AMap.version)n("不允许多个版本 JSAPI 混用");else{var f=[];if(e.plugins)for(l=0;l<e.plugins.length;l+=1)t.AMap.plugins.indexOf(e.plugins[l])==-1&&f.push(e.plugins[l]);E(function(){f.length?window.AMap.plugin(f,function(){w(e).then(function(){d(window.AMap)}).catch(n)}):w(e).then(function(){d(window.AMap)}).catch(n)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,t={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},i={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},m={AMap:[],AMapUI:[],Loca:[]}}}})})($);var H=$.exports;const Q=K(H),X={class:"yz-map"},ee={class:"location-info"},oe={key:0,class:"loading-tip"},ne=["id"],ae=Y({__name:"YZMap",props:{defualtLocation:{default:""},isLimited:{type:Boolean,default:!1},enableMapClick:{type:Boolean,default:!0},defaultAddress:{default:""},showLocation:{type:Boolean,default:!1},bindModel:{default:""}},emits:["confirm","cancel"],setup(x,{emit:j}){const w=x,y=U(!1);Z(()=>w.showLocation,async a=>{y.value=a,a&&(t.value=!0,await e())});const G=j,o=U(""),t=U(!1),i=U(),m=U([]),r=U({lng:0,lat:0,pcd:"",pcdDetail:"",address:""}),E=F(),e=async()=>{const a=E.getAuthConfig;if(window._AMapSecurityConfig={securityJsCode:a.GDsecurityJsCode},await Q.load({key:a.GDmapsKey,version:a.GDversion,plugins:["AMap.Geolocation","AMap.PlaceSearch","AMap.CitySearch","AMap.Geocoder"]})){const h=w.bindModel,v=new AMap.Map(h,{viewMode:"3D",...w.isLimited&&{zoomEnable:!1,dragEnable:!1}});t.value=!1,i.value=v,v.on("click",d),w.defualtLocation?l(w.defualtLocation,(A,p,g)=>{A&&(v.setCenter([p,g]),n(p,g))}):M(A=>{const{position:p}=A;p&&(v.setCenter([p.lng,p.lat]),s(p.lng,p.lat),n(p.lng,p.lat))},A=>{W(`高德地图提示: 无法获取当前位置,${A.message}`)})}},d=a=>{const c=a.lnglat,h=c.lng,v=c.lat;n(h,v)},n=(a,c)=>{if(m.value.length===1&&!w.enableMapClick)return;const h=[a,c],v=new AMap.Marker({position:h});m.value.length>0&&m.value.forEach(A=>{i.value.remove(A)}),m.value.push(v),i.value.add(v),s(a,c)},s=(a,c)=>{AMap.plugin("AMap.Geocoder",function(){const h=new AMap.Geocoder({}),v=[a,c];h.getAddress(v,function(A,p){if(A==="complete"&&p.info==="OK"){const{formattedAddress:g,addressComponent:b}=p.regeocode,L=[b.province,b.city,b.district];r.value.lat=c,r.value.lng=a,r.value.address=g,r.value.pcd=L.join("/");let _=g;L.forEach(R=>{_=_.replace(R,"")}),r.value.pcdDetail=_,o.value=g}})})},l=(a,c)=>{AMap.plugin("AMap.Geocoder",function(){new AMap.Geocoder({}).getLocation(a,function(v,A){if(v==="complete"&&A.info==="OK"){const{geocodes:p}=A;if(p&&p.length>0){const g=p[0];r.value.lat=g.location.lat,r.value.lng=g.location.lng,r.value.address=a;const b=[g.addressComponent.province,g.addressComponent.city,g.addressComponent.district];r.value.pcd=b.join("/");let L=g.formattedAddress;b.forEach(_=>{L=L.replace(_,"")}),r.value.pcdDetail=L}c(!0,r.value.lng,r.value.lat)}else c(!1,0,0)})})},M=(a,c)=>{AMap.plugin("AMap.Geolocation",function(){var h=new AMap.Geolocation({enableHighAccuracy:!0,timeout:5e3,offset:[10,20],zoomToAccuracy:!0,position:"RB"});h.getCurrentPosition(function(v,A){v=="complete"?a(A):c(A)})})},f=()=>{I(),G("confirm",r.value)},u=()=>{I(),G("cancel")},I=()=>{i.value&&i.value.destroy()};return(a,c)=>{const h=k("YZNav"),v=k("van-icon"),A=k("van-field"),p=k("van-loading"),g=k("van-popup");return O(),D("div",X,[C(g,{show:S(y),"onUpdate:show":c[1]||(c[1]=b=>B(y)?y.value=b:null),position:"bottom",style:{height:"100%"}},{default:P(()=>[C(h,{title:a.$t("Form.SelectPositon"),"left-text":a.$t("Global.Cancle"),"left-arrow":"",onOnRightClick:f,onOnLeftClick:u},{right:P(()=>[J(N(a.$t("Global.Enter")),1)]),_:1},8,["title","left-text"]),V("div",ee,[C(A,{modelValue:S(o),"onUpdate:modelValue":c[0]||(c[0]=b=>B(o)?o.value=b:null),label:a.$t("Form.CurrentPosition"),type:"textarea",autosize:"",readonly:""},{"left-icon":P(()=>[C(v,{name:"location",class:"location-icon"})]),_:1},8,["modelValue","label"])]),S(t)?(O(),D("div",oe,[C(p,{type:"spinner"},{default:P(()=>[J(N(a.$t("Global.Loading")),1)]),_:1})])):T("",!0),V("div",{id:a.bindModel,class:"map-container",style:{width:"100%",height:"50vh"}},null,8,ne)]),_:1},8,["show"])])}}}),se=q(ae,[["__scopeId","data-v-23d4498f"]]);export{se as default};
