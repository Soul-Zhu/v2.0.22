import{d as ee,y as U,c as oe,m as b,w as te,a as F,g as m,b as s,e as c,h as f,F as ae,j as le,u as x,r,k as D,t as y,i as E,s as V,n as C,K as ne,H as se}from"./main-BnXXyOo5.js";import{u as ue}from"./encodeext-DBC3bVZy.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"popup-warp-content"},de={class:"filter-box"},re={class:"filter-box"},ie={class:"popup-warp-button"},me=ee({__name:"FilterPopup",props:{show:{type:Boolean,default:!1},ds:{default:null},schema:{default:()=>[]},viewsColumns:{},dsConfigParams:{}},emits:["onSearch","update:show"],setup(P,{emit:R}){const B=U("Form.include"),I=U("home.All"),g={number:[">",">=","=","<","<=","!="],string:[B,">",">=","=","<","<=","!="],date:[">",">=","=","<","<=","!="],datetime:[">",">=","=","<","<=","!="],bool:["="],char:[">",">=","=","<","<=","!="]},G={Decimal:"number",Double:"number",Single:"number",Int16:"number",Int32:"number",Int64:"number",UInt16:"number",UInt32:"number",UInt64:"number",SByte:"number",Byte:"number",Char:"string",Boolean:"bool",DateTime:"datetime",String:"string"},d=P,S=R,k=oe({get:()=>d.show,set:o=>{S("update:show",o)}}),_=b([]),N=b([]),u=b([]);te(k,o=>{o&&(L(),N.value=g.string.map(e=>({text:e})),$())});const L=()=>{_.value=[],d.ds&&(d.ds.type!==se.esb&&_.value.push({text:I}),d.viewsColumns&&d.viewsColumns.length>0?d.viewsColumns.forEach(o=>{const e=o.displayName??o.columnName;_.value.push({text:e,value:o.columnName})}):d.schema.forEach(o=>{_.value.push({text:o.columnName})}))},j=(o,e)=>{const n=d.dsConfigParams,a=u.value;a[e].fieldText=o.text,a[e].fieldValue=o.value;const i=n.find(p=>p.name===o.text);if(i){const p=G[i.dataType];a[e].ops=g[p].map(h=>({text:h})),a[e].opsText=a[e].ops[0].text,a[e].filterType=p,a[e].value=""}else a[e].ops=g.string.map(p=>({text:p})),a[e].opsText=a[e].ops[0].text,a[e].filterType="string",a[e].value=""},q=(o,e)=>{const n=u.value;n[e].opsText=o.text},$=()=>{u.value.length===0&&z()},z=()=>{u.value.push({check:!0,fields:_.value,ops:N.value,value:"",fieldShow:!1,opsShow:!1,opsText:B,fieldText:I,fieldValue:"all",onFieldClick:j,onOpsClick:q,filterType:"string"})},O=o=>{if(u.value.length<=1){const n=U("Form.NeedLastFilter");ne(n,"warning");return}u.value.splice(o,1)},{isEmpty:H,encode:K,encodeBase64:M}=ue(),J=()=>{const o=[];u.value&&u.value.length>0&&u.value.forEach(n=>{const a=n.value;if(n.check&&!H(a,void 0)){const i={name:n.fieldValue,op:n.opsText==="包含"?"like":n.opsText,value:a,isAll:n.fieldValue==="all"};o.push(i)}});const e=M(K(o));S("onSearch",e)},v=b(!1),T=b(-1),Q=o=>{T.value=o,v.value=!0},W=()=>{u.value=[],$(),S("onSearch","")},X=({selectedValues:o})=>{const e=T.value,n=u.value[e];n.value=o.join("/")+" 00:00:00",v.value=!1,T.value=-1};return(o,e)=>{const n=r("van-switch"),a=r("van-col"),i=r("van-popover"),p=r("van-field"),h=r("van-button"),Y=r("van-row"),A=r("van-popup"),Z=r("van-date-picker");return m(),F("div",null,[s(A,{show:x(k),"onUpdate:show":e[0]||(e[0]=t=>E(k)?k.value=t:null),position:"top","close-on-click-overlay":!0,teleport:"body","safe-area-inset-top":""},{default:c(()=>[f("div",pe,[(m(!0),F(ae,null,le(x(u),(t,w)=>(m(),F("div",{class:"popup-warp-item",key:w},[s(Y,{gutter:"5"},{default:c(()=>[s(a,{span:"4",style:{"margin-top":"10px"}},{default:c(()=>[s(n,{size:"20",modelValue:t.check,"onUpdate:modelValue":l=>t.check=l},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s(a,{span:"6",class:"poup-col"},{default:c(()=>[s(i,{show:t.fieldShow,"onUpdate:show":l=>t.fieldShow=l,actions:t.fields,onSelect:l=>t.onFieldClick(l,w)},{reference:c(()=>[f("div",de,y(t.fieldText),1)]),_:2},1032,["show","onUpdate:show","actions","onSelect"])]),_:2},1024),s(a,{span:"4",class:"poup-col"},{default:c(()=>[s(i,{show:t.opsShow,"onUpdate:show":l=>t.opsShow=l,actions:t.ops,onSelect:l=>t.onOpsClick(l,w)},{reference:c(()=>[f("div",re,y(t.opsText),1)]),_:2},1032,["show","onUpdate:show","actions","onSelect"])]),_:2},1024),s(a,{span:"6"},{default:c(()=>[t.filterType==="string"?(m(),V(p,{key:0,label:"",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,placeholder:o.$t("Form.requiredField")},null,8,["modelValue","onUpdate:modelValue","placeholder"])):C("",!0),t.filterType==="number"?(m(),V(p,{key:1,label:"",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,type:"number",placeholder:o.$t("Form.requiredField")},null,8,["modelValue","onUpdate:modelValue","placeholder"])):C("",!0),t.filterType==="bool"?(m(),V(n,{key:2,size:"20",modelValue:t.value,"onUpdate:modelValue":l=>t.value=l},null,8,["modelValue","onUpdate:modelValue"])):C("",!0),t.filterType==="datetime"?(m(),V(p,{key:3,modelValue:t.value,"onUpdate:modelValue":l=>t.value=l,"is-link":"",readonly:"",onClick:l=>Q(w),name:"datePicker"},null,8,["modelValue","onUpdate:modelValue","onClick"])):C("",!0)]),_:2},1024),s(a,{span:"4"},{default:c(()=>[s(h,{icon:"plus",size:"mini",type:"primary",onClick:z}),s(h,{icon:"minus",size:"mini",type:"danger",onClick:l=>O(w)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),f("div",ie,[f("div",null,[s(h,{block:"",round:"",size:"small",type:"primary",onClick:J},{default:c(()=>[D(y(o.$t("Global.Search")),1)]),_:1})]),f("div",null,[s(h,{block:"",round:"",size:"small",onClick:W},{default:c(()=>[D(y(o.$t("Global.Reset")),1)]),_:1})])])]),_:1},8,["show"]),s(A,{show:x(v),"onUpdate:show":e[2]||(e[2]=t=>E(v)?v.value=t:null),position:"bottom"},{default:c(()=>[s(Z,{onConfirm:X,onCancel:e[1]||(e[1]=t=>v.value=!1)})]),_:1},8,["show"])])}}}),_e=ce(me,[["__scopeId","data-v-56c63db6"]]);export{_e as default};
