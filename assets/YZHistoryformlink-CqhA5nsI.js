import{d as b,L as k,M as R,m as d,w as T,o as B,x as D,Q as c,a as F,l as K,v as U,u as l,h as V,b as q,s as W,e as A,r as G,G as L,q as x,p as $,K as M,g as C,t as Q}from"./main-BnXXyOo5.js";import{_ as Y}from"./YZHistoryFormRead.vue_vue_type_script_setup_true_lang-Cskroz3e.js";import{u as Z}from"./formWatch-KqHO0hI-.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useDefaultRow-Bhv6lFSR.js";import"./LoginFactory-C2TRmDIo.js";import"./wecom.prod-DVLinVsr.js";import"./dynamic-import-helper-BheWnx7M.js";import"./useInitFieldState-EKN-2KHT.js";import"./formStore-Byb73AL_.js";import"./useProcessFormData-BB1RW82V.js";import"./useFormEnv-VwQXjqJl.js";import"./encodeext-DBC3bVZy.js";const P=b({__name:"YZHistoryformlink",props:k({cfg:{},formRow:{}},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:k(["update:field"],["update:modelValue"]),setup(g,{emit:H}){const{WatchChageExpress:y,WatchSelfExpress:E}=Z(),t=R(g,"modelValue"),m=d(!1),f=d("尚未关联"),h=d(""),_=d(""),r=g,a=d(r.cfg);T(()=>t.value,async e=>{await w(String(e)),y(r.cfg,e,r.formRow)});const w=async e=>{if(!e)return;const o=x.getHistoryFormInfo.url.toFetchUrl({params1:e}),{success:u,data:s,errorMessage:p}=await $(o);if(!u){M(p,"danger");return}const v=r.cfg.fieldDisplayText;s&&(f.value=N(s,v))},i=H;B(async()=>{I(),t.value&&await w(String(t.value)),D(()=>{E(a.value,r.formRow,e=>{t.value=e,f.value=e},e=>{a.value.hidden=e,i("update:field",a.value)},e=>{},e=>{a.value.disabled=e,i("update:field",a.value)})})});const I=()=>{const e=a.value,o=`setHidden_${e.uuid}_${e.fullKey}`,u=`setColumnHidden_${e.uuid}_${e.fullKey}`,s=`setRules_${e.uuid}_${e.fullKey}`,p=`autoActiveEvent_${e.uuid}_${e.fullKey}`,v=`setClose_${e.uuid}`;c.on(o,n=>{a.value.hidden=n,i("update:field",a.value)}),c.on(v,n=>{_.value=n}),c.on(u,n=>{a.value.hidden=n,i("update:field",a.value)}),c.on(s,n=>{a.value.rules=[n],i("update:field",a.value)}),c.on(p,n=>{y(r.cfg,t.value,r.formRow)})},N=(e,o)=>e[o],S=async()=>{if(!t.value)return;const e=x.getHisotryReadToken.url.toFetchUrl({params1:t.value}),{success:o,errorMessage:u,data:s}=await $(e);if(!o){M(u,"danger");return}h.value=s.token,m.value=!0};return(e,o)=>{const u=G("van-field");return C(),F("div",{class:L(l(_))},[K(V("div",null,[q(u,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value=s),readonly:"",name:l(a).bindModel,label:l(a).fieldLabel,required:l(a).required,rules:l(a).rules,placeholder:l(a).placeholder},{input:A(()=>[V("div",{class:"history-form-link",onClick:S},Q(l(f)),1)]),_:1},8,["modelValue","name","label","required","rules","placeholder"]),(C(),W(Y,{formId:t.value,show:l(m),taskId:t.value,key:new Date().getTime(),token:l(h),"onUpdate:show":o[1]||(o[1]=s=>m.value=s)},null,8,["formId","show","taskId","token"]))],512),[[U,!l(a).hidden]])],2)}}}),ie=z(P,[["__scopeId","data-v-138cd1dd"]]);export{ie as default};
