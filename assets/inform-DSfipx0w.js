const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./RecordPopup-DKCYEjJ4.js","./main-BnXXyOo5.js","./main-CVDmtNd4.css","./useFormEnv-VwQXjqJl.js","./_plugin-vue_export-helper-DlAUqK2U.js","./RecordPopup-TQTAKzRY.css"])))=>i.map(i=>d[i]);
import{A as Q,m as t,E as X,c as ee,D as oe,o as se,Q as ne,aI as te,W as re,X as ae,Z as $,q as ie,J as ce,K as ue,a0 as me,d as le,w as de,a as L,g as k,h as V,b as g,s as Y,n as A,e as q,u as n,r as H,aM as fe,i as pe,f as ge,_ as ve,a1 as Z}from"./main-BnXXyOo5.js";import{c as _e,u as Ie,a as Ce,b as we,_ as Fe}from"./useDefaultRow-Bhv6lFSR.js";import{a as he}from"./app.hook-BvqEBUQR.js";import{u as Re,F as De}from"./FormTool-uahxYRvh.js";import{u as Pe,P as ke}from"./PostDialog-Cs01WTTG.js";import{u as Se}from"./useProcessFormData-BB1RW82V.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./LoginFactory-C2TRmDIo.js";import"./wecom.prod-DVLinVsr.js";import"./dynamic-import-helper-BheWnx7M.js";import"./useInitFieldState-EKN-2KHT.js";import"./useFormEnv-VwQXjqJl.js";const{createRequiredFlag:ye}=Pe(),{deleteEventHandler:l,deleteFormFieldEvent:be,deleteExtendEventHandler:Me}=_e(),{getProcessInformInfo:Ee,getFormDefined:Te}=Re(),Be=oe(),o=re(),Ae=()=>{const O=Q(),S=t(""),i=t([]),c=t({}),v=t(!1),_=X(),d=t(!1),I=t(!1),C=t(""),u=t(""),N=t(""),w=t({}),{parseSrcModel:F,parseSrcComponent:y}=Ie(),{createControlConfig:b}=Ce(),{createDefaultRow:r}=we(),{buildProcessFormData:f}=Se(),M=ee(()=>Be.getApp),h=t(!1),E=async()=>{const a=ae(),{stepId:R,taskId:T}=O.params;u.value=String(R),N.value=String(T);const e=await Ee(String(R));if(!e)return;const s=e.form.formId;o.setRuningFormId(s),o.setRuningCurrentNodeName(s,e.activityName),o.setRuningCurrentNodeId(s,e.activityId),o.setProcessInFormDefined(s,e),C.value=e.processName,S.value=e.processVersion,I.value=e.permisions.Consign,h.value=e.taskInstance.stepFinished;const D=await Te(s);if(o.setRuningSn(s,e.processInstance.serialNum),o.setRuningStartTime(s,e.processInstance.startTime),o.setRuningInitaotr(s,e.processInstance.initiatorAccount),o.setRuningOwnerAccount(s,e.processInstance.ownerAccount),e.processInstance.ouid){const m=e.processInstance.ouid.split("."),J=m[0],K=m[1];o.setRuningProviderName(s,J),o.setRuningOuId(s,K)}if(e.processInstance.ownerPosition){const m=e.processInstance.ownerPosition.split(".");o.setRuningMember(s,m[1])}const B=F(D.src),p=y(B);ye(p.definition.components,e.actions),o.setRuningFunctions(s,p.funcs),o.setRuningValidators(s,p.validators);const{cfgs:P,cfgForm:qe,plains:W}=await b(p.definition,D,e.viewModel,$.NOFITY),x=f(e.viewModel.data);w.value=r(x),c.value=x,i.value=P,o.setRunningDefaultCfg(s,P),o.setRuningFormData(s,c),W.forEach(m=>{o.addRunningPlainCfg(s,m)}),sessionStorage.setItem("env","inform"),v.value=!0,a&&a.remove()},j=()=>{he(_)},z=async a=>{const R=ie.informReadTask.url.toFetchUrl({params1:u.value}),T={comments:a.comment},{success:e,data:s,errorMessage:D}=await ce(R,T);if(!e){ue(D,"danger");return}const B=o.getCurrentFormId,P=o.getRuningProcessInFormDefined(B).processInstance.serialNum;me({title:"提交成功",message:`提交已成功!
业务流水号: ${P}
窗口将被关闭。`}).then(()=>{_.push({path:"/layout/home",replace:!0})})},G=()=>{d.value=!1};se(async()=>{ne.on("onForm_ProcessRead",a=>{d.value=!0}),await E()}),te(()=>{const a=o.getCurrentFormId;be(!0),Me(!0),l("onForm_MoreClose",!0),l("onForm_Agreen",!0),l("onForm_ProcessRead",!0),l("onForm_PostSubmit",!0),l("onForm_DraftSubmit",!0),l("onMapCfg_Update",!0),o.removeFormIdData(a)});const U=t(!1);return{formData:c,fields:i,formRow:w,render:v,onLeftClick:j,showContent:d,onCanlePost:G,onConfirmPost:z,processName:C,moreShow:U,onMoreClick:()=>{U.value=!0},isComplete:h,app:M}},Oe={class:"post-main"},Ue={class:"post-header"},xe={key:0,class:"post-form"},Le={class:"post-button"},Ve=le({__name:"inform",setup(O){const{onLeftClick:S,render:i,fields:c,showContent:v,onCanlePost:_,onConfirmPost:d,formData:I,processName:C,moreShow:u,onMoreClick:N,isComplete:w,app:F,formRow:y}=Ae();Z("formData",I),Z("formField",c),de(I,(r,f)=>{window.formDataBase=r},{deep:!0});const b=ge(()=>ve(()=>import("./RecordPopup-DKCYEjJ4.js").then(r=>r.b),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url));return(r,f)=>{const M=H("van-icon"),h=H("YZNav");return k(),L("div",Oe,[V("div",Ue,[g(h,{title:n(C),leftText:r.$t(n(F)?"Global.Close":"Global.Back"),showBack:!n(F),onOnLeftClick:n(S),rightText:""},{right:q(()=>[g(M,{name:"more-o",size:"22",onClick:n(N)},null,8,["onClick"])]),_:1},8,["title","leftText","showBack","onOnLeftClick"])]),g(fe,{name:"van-slide-left"},{default:q(()=>[n(i)?(k(),L("div",xe,[g(Fe,{cfg:n(c),ref:"formRef","form-row":n(y)},null,8,["cfg","form-row"])])):A("",!0)]),_:1}),V("div",Le,[n(i)&&!n(w)?(k(),Y(De,{key:0,env:n($).NOFITY},null,8,["env"])):A("",!0)]),g(ke,{show:n(v),consign:!1,"onUpdate:show":n(_),"onUpdate:confirm":n(d)},null,8,["show","onUpdate:show","onUpdate:confirm"]),n(i)?(k(),Y(n(b),{key:0,"more-show":n(u),"onUpdate:moreShow":f[0]||(f[0]=E=>pe(u)?u.value=E:null)},null,8,["more-show"])):A("",!0)])}}}),oo=Ne(Ve,[["__scopeId","data-v-922e644a"]]);export{oo as default};
