import{d as E,L as k,m,M as q,o as K,x as D,w as F,Q as p,a as b,l as H,v as L,u as s,h as W,b as g,e as y,i as $,r as N,G as Y,J as Z,q as A,g as _,n as G,F as I,j as T,s as z,k as J,t as O}from"./main-BnXXyOo5.js";import{_ as P}from"./YZChangeFieldTag.vue_vue_type_style_index_0_lang-CU_sMXjx.js";import Q from"./YZUserSelect-i1CO06-2.js";import{u as X}from"./formWatch-KqHO0hI-.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./encodeext-DBC3bVZy.js";import"./useFormEnv-VwQXjqJl.js";import"./useInitFieldState-EKN-2KHT.js";const ae={key:0},le=E({__name:"YZUsers",props:k({cfg:{},formRow:{}},{modelValue:{type:String},modelModifiers:{}}),emits:k(["update:field"],["update:modelValue"]),setup(w,{emit:S}){const h=m([]),t=m(),n=q(w,"modelValue"),c=w,a=m(c.cfg),v=m(!1),U=()=>{var e;if(!c.cfg.disabled){if(h.value=[],t.value&&n.value){const l=n.value.split(","),o=(e=t.value)==null?void 0:e.split(",");for(let u=0;u<o.length;u++)h.value.push({name:o[u],account:l[u]})}v.value=!0}},x=e=>{e&&e.length>0?(n.value=e.map(l=>l.account).join(","),t.value=e.map(l=>l.name).join(",")):(n.value="",t.value="")},j=e=>{if(t.value&&n.value){let l=t.value.split(","),o=n.value.split(",");l.splice(e,1),o.splice(e,1),t.value=l.join(","),n.value=o.join(",")}},C=async e=>{if(!e)return;let o=(await Z(A.getUsersSimple.url,{accounts:e.split(",")})).data;t.value=o&&o.length>0&&o.map(u=>u.text).join(",")||""};K(()=>{D(async()=>{R(),n.value&&await C(n.value),B(a.value,c.formRow,e=>{},e=>{a.value.hidden=e,d("update:field",a.value)},e=>{a.value.disabled=e,d("update:field",a.value)},e=>{a.value.hidden=e,d("update:field",a.value)})})}),F(()=>n.value,async e=>{M(c.cfg,e,c.formRow),e&&await C(e)});const{WatchSelfExpress:B,WatchChageExpress:M}=X(),d=S,V=m(""),R=()=>{const e=a.value,l=`setDisabled_${e.uuid}_${e.fullKey}`,o=`setHidden_${e.uuid}_${e.fullKey}`,u=`setColumnHidden_${e.uuid}_${e.fullKey}`,r=`setRules_${e.uuid}_${e.fullKey}`,f=`setClose_${e.uuid}`;p.on(l,i=>{a.value.disabled=i,d("update:field",a.value)}),p.on(o,i=>{a.value.hidden=i,d("update:field",a.value)}),p.on(u,i=>{a.value.hidden=i,d("update:field",a.value)}),p.on(r,i=>{a.value.rules=[i],d("update:field",a.value)}),p.on(f,i=>{V.value=i})};return(e,l)=>{const o=N("van-tag"),u=N("van-field");return _(),b("div",{class:Y(s(V))},[H(W("div",null,[g(u,{readonly:"",name:s(a).bindModel,label:s(a).fieldLabel,placeholder:s(a).placeholder,required:s(a).required,disabled:s(a).disabled,clickable:"","is-link":!s(a).disabled,rules:s(a).rules,modelValue:s(t),"onUpdate:modelValue":l[0]||(l[0]=r=>$(t)?t.value=r:null),onClick:U},{input:y(()=>[s(t)?(_(),b("div",ae,[(_(!0),b(I,null,T(s(t).split(","),(r,f)=>(_(),z(o,{class:"user-tag",closeable:!s(a).disabled,key:f,type:"primary",plain:"",onClose:i=>j(f)},{default:y(()=>[J(O(r),1)]),_:2},1032,["closeable","onClose"]))),128))])):G("",!0)]),button:y(()=>[g(P,{field:s(a)},null,8,["field"])]),_:1},8,["name","label","placeholder","required","disabled","is-link","rules","modelValue"]),g(Q,{show:s(v),"onUpdate:show":l[1]||(l[1]=r=>$(v)?v.value=r:null),multiple:"","default-users":s(h),onOnSave:x},null,8,["show","default-users"])],512),[[L,!s(a).hidden]])],2)}}}),ce=ee(le,[["__scopeId","data-v-0e4059ec"]]);export{ce as default};
