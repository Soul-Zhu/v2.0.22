import{d as A,L as x,W as z,M as G,m as _,o as J,x as Q,w as X,J as ee,I as ae,H as k,q as E,c as te,Q as p,a as se,l as oe,v as le,u as r,h as ne,b as B,e as ue,i as ce,r as M,G as re,g as de}from"./main-BnXXyOo5.js";import{u as ie}from"./formWatch-KqHO0hI-.js";import{u as fe}from"./encodeext-DBC3bVZy.js";import{u as me}from"./useFormEnv-VwQXjqJl.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useInitFieldState-EKN-2KHT.js";const ve=A({__name:"YZValuetodisplay",props:x({cfg:{},formRow:{}},{modelValue:{},modelModifiers:{}}),emits:x(["update:field"],["update:modelValue"]),setup($,{emit:j}){const{getFormEnv:q}=me();q();const O=z(),i=G($,"modelValue"),v=_(""),s=$,t=_(s.cfg),{getFormValue:N,setFormValue:C}=ae(),{WatchChageExpress:D,WatchSelfExpress:T}=ie(),{isEmpty:U,encode:R,encodeBase64:F}=fe(),b=_(!1);J(async()=>{Q(async()=>{P(),L(),b.value=!0,await S(),b.value=!1,T(t.value,s.formRow,e=>{i.value=e,w()},e=>{t.value.hidden=e,f("update:field",t.value)},e=>{t.value.disabled=e,f("update:field",t.value)},e=>{t.value.hidden=e,f("update:field",t.value)})})});const S=async()=>{i.value&&await w()};X(()=>i.value,async e=>{D(s.cfg,e,s.formRow),await w()});const w=async()=>{const e=H(s.cfg.ds);if(!e)return;const a=W(),{success:l,errorMessage:u,data:n}=await ee(e,a);if(!l)v.value=i.value;else if(n&&n.length>0){const c=n[0];I(c,s.cfg.ds)}else v.value=i.value,I({},s.cfg.ds)},I=(e,a)=>{if(!a)return;const l=a.map,u=Object.keys(l);for(const n of u){const c=n,d=l[n],o=e[c]??"",g=s.formRow[d];if(b.value){const h=N(s.cfg,d);(U(h)||g!=h)&&C(s.cfg,d,o),b.value=!1}else C(s.cfg,d,o)}e&&Object.keys(e).length>0&&(v.value=e[a.displayField])},H=e=>{let a="";if(!e)return a;switch(e.type){case k.table:a=E.getTableDatSource.url.toFetchUrl({params1:e.dataSourceId,params2:e.tableName});break;case k.esb:a=E.getEsbDataSourceNoPage.url.toFetchUrl({params1:e.dataSourceId});break;case k.form:a=E.getFormDataSource.url.toFetchUrl({params1:e.dataSourceId,params2:e.tableName});break}return a},L=()=>{const e=s.cfg;if(!e.ds)return null;const a=e.ds.filter,l=Object.keys(a);if(l.length>0)for(const u of l){const n=a[u];if(n.type==="field"){const c=n.value;Z(c)}}},W=()=>{const e=s.cfg;if(!e.ds)return null;const a=new FormData,l=e.ds.filter,u=Object.keys(l),n=e.ds.valueField,c={};if(c[n]={op:"=",value:i.value},u.length>0)for(const y of u){const m=l[y];if(m.type==="field"){const V=m.value;c[y]={op:m.op,value:N(s.cfg,V)}}else c[y]={op:m.op,value:m.value}}const d=F(R(c));a.append("f",d);let o=e.ds.orderBy;o&&(o=F(e.ds.orderBy)),a.append("o",o);const g=[];if(g.push(e.ds.displayField),e.ds.map){const y=e.ds.map,m=Object.keys(y);for(const V of m)g.push(V)}const h=F(R(g));return a.append("c",h),a},f=j,K=_(""),Y=te(()=>O.getCurrentFormId),Z=e=>{const a=`onField_Filter_${e}_${Y.value}`;p.on(a,async l=>{s.cfg.ds&&await S()})},P=()=>{const e=t.value,a=`setDisabled_${e.uuid}_${e.fullKey}`,l=`setHidden_${e.uuid}_${e.fullKey}`,u=`setColumnHidden_${e.uuid}_${e.fullKey}`,n=`setRules_${e.uuid}_${e.fullKey}`,c=`autoActiveEvent_${e.uuid}_${e.fullKey}`,d=`setClose_${e.uuid}`;p.on(a,o=>{t.value.disabled=o,f("update:field",t.value)}),p.on(l,o=>{t.value.hidden=o,f("update:field",t.value)}),p.on(u,o=>{t.value.hidden=o,f("update:field",t.value)}),p.on(n,o=>{t.value.rules=[o],f("update:field",t.value)}),p.on(d,o=>{K.value=o}),p.on(c,o=>{D(s.cfg,i.value,s.formRow)})};return(e,a)=>{const l=M("YZChangeFieldTag"),u=M("van-field");return de(),se("div",{class:re(r(K))},[oe(ne("div",null,[B(u,{modelValue:r(v),"onUpdate:modelValue":a[0]||(a[0]=n=>ce(v)?v.value=n:null),readonly:"",name:r(t).bindModel,required:r(t).required,disabled:r(t).disabled,label:r(t).fieldLabel,rules:r(t).rules,placeholder:r(t).placeholder},{button:ue(()=>[B(l,{field:r(t)},null,8,["field"])]),_:1},8,["modelValue","name","required","disabled","label","rules","placeholder"])],512),[[le,!r(t).hidden]])],2)}}}),we=pe(ve,[["__scopeId","data-v-322609c3"]]);export{we as default};
