import{d as W,c as X,m as h,o as ee,p as D,w as ae,a as m,b as f,e as r,r as u,q,g as s,h as d,n as A,s as g,l as te,F as C,j as x,v as oe,k as b,t as k}from"./main-BnXXyOo5.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"path-line"},se=["onClick"],ue={key:0,class:"select-org"},re={class:"depart-cell"},ce=["onClick"],ie={class:"depart-cell"},de=["onClick"],ve=W({__name:"YZOrgSelect",props:{show:{type:Boolean,required:!0,default:!0},multiple:{type:Boolean,required:!1,default:!1},defaultOrgs:{type:Array,required:!1,default:[]}},emits:["update:show","onSave"],setup($,{emit:E}){const i=$,S=X(()=>i.show),N=E,U=()=>{p.value=[],n.value=[],v.value="",N("update:show",!1),y()},G=()=>{N("onSave",c.value),p.value=[],v.value="",y(),N("update:show",!1)},R=e=>{c.value=[],e&&e.length>0&&e.forEach(a=>{V(a)})},M=e=>{c.value=[],V(e)},V=e=>{const a=L.value.find(l=>l.ouid==e);a&&c.value.push({name:a.text,code:a.code,ouid:a.ouid,modelValue:`${a.providerName}.${a.ouid}`})},n=h([]),_=h([]),v=h(""),p=h([]),c=h(i.defaultOrgs),L=h([]);ee(async()=>{y()});const y=async()=>{const{data:e}=await D(q.getOrgs.url);B(e),n.value=[{name:"全部",ouid:"all",icon:!1,providerName:"",code:"",sid:"",ouLevel:""}]},O=async e=>{const a=q.getOrgChildren.url.toFetchUrl({params1:e.providerName,params2:e.ouid}),{data:l}=await D(a);B(l);let t={...e,name:e.text||e.name};T(t)},B=e=>{_.value=[],e&&e.length>0&&e.forEach(a=>{const l={type:"ou",...a};_.value.push(l)}),L.value.push(..._.value)},P=e=>{if(e.ouid==="all")y(),n.value=[{name:"全部",ouid:"all",icon:!1,providerName:"",code:"",sid:"",ouLevel:""}];else{let a={...e,text:e.text||e.name};O(a)}},T=e=>{const a=n.value.find(t=>t.name===e.name),l=[];if(a){for(let t=0;t<n.value.length;t++)if(n.value[t].name===e.name){l.push({icon:!1,name:e.name,ouid:e.ouid,code:e.code,ouLevel:e.ouLevel,sid:e.sid,providerName:e.providerName});break}else l.push({icon:!0,name:n.value[t].name,ouid:n.value[t].ouid,code:n.value[t].code,ouLevel:n.value[t].ouLevel,sid:n.value[t].sid,providerName:n.value[t].providerName});n.value=l}else n.value.forEach(t=>{t.icon=!0}),n.value.push(e)},Y=e=>{const a=c.value.findIndex(t=>t.ouid==e);a>-1&&c.value.splice(a,1);const l=p.value.findIndex(t=>t==e);l>-1&&p.value.splice(l,1),e===v.value&&(v.value="")};return ae(()=>i.show,(e,a)=>{e&&(i.defaultOrgs&&i.defaultOrgs.length>0?i.multiple?p.value=i.defaultOrgs.map(t=>Number(t.ouid)):v.value=Number(i.defaultOrgs[0].ouid):c.value.length=0)}),(e,a)=>{const l=u("van-nav-bar"),t=u("van-icon"),Z=u("van-tag"),j=u("van-checkbox"),F=u("van-cell"),I=u("van-cell-group"),Q=u("van-checkbox-group"),z=u("van-radio"),H=u("van-radio-group"),J=u("van-empty"),K=u("van-popup");return s(),m("div",null,[f(K,{show:S.value,"onUpdate:show":a[2]||(a[2]=o=>S.value=o),teleport:"body",position:"bottom",style:{height:"100%"}},{default:r(()=>[f(l,{title:e.$t("Form.DepartSelect"),"left-text":e.$t("Global.Cancle"),"right-text":e.$t("Global.Enter"),"left-arrow":"",onClickRight:G,onClickLeft:U},null,8,["title","left-text","right-text"]),a[3]||(a[3]=d("div",null,null,-1)),d("div",le,[(s(!0),m(C,null,x(n.value,o=>(s(),m("div",{class:"li-div",key:o.name,onClick:w=>P(o)},[b(k(o.name)+" ",1),o.icon?(s(),g(t,{key:0,name:"arrow",style:{"margin-left":"-13px"}})):A("",!0)],8,se))),128))]),c.value.length>0?(s(),m("div",ue,[(s(!0),m(C,null,x(c.value,(o,w)=>(s(),g(Z,{key:w,class:"org-tag",closeable:"",type:"primary",plain:"",onClose:pe=>Y(o.ouid)},{default:r(()=>[b(k(o.name),1)]),_:2},1032,["onClose"]))),128))])):A("",!0),$.multiple?(s(),g(Q,{key:1,shape:"square",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=o=>p.value=o),onChange:R},{default:r(()=>[f(I,null,{default:r(()=>[d("div",null,[(s(!0),m(C,null,x(_.value,o=>(s(),g(F,{key:o.text},{default:r(()=>[d("div",re,[f(j,{name:o.ouid},{default:r(()=>[b(k(o.text),1)]),_:2},1032,["name"])]),d("div",{class:"depart-down",onClick:w=>O(o)},k(e.$t("Form.subDepartments")),9,ce)]),_:2},1024))),128))])]),_:1})]),_:1},8,["modelValue"])):(s(),g(H,{key:2,onChange:M,modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=o=>v.value=o)},{default:r(()=>[f(I,null,{default:r(()=>[d("div",null,[(s(!0),m(C,null,x(_.value,o=>(s(),g(F,{key:o.text},{default:r(()=>[d("div",ie,[f(z,{name:o.ouid},{default:r(()=>[b(k(o.text),1)]),_:2},1032,["name"])]),d("div",{class:"depart-down",onClick:w=>O(o)},k(e.$t("Form.subDepartments")),9,de)]),_:2},1024))),128))])]),_:1})]),_:1},8,["modelValue"])),te(f(J,{description:e.$t("Form.noDepart")},null,8,["description"]),[[oe,_.value.length<=0]])]),_:1},8,["show"])])}}}),_e=ne(ve,[["__scopeId","data-v-9c68ec40"]]);export{_e as default};
