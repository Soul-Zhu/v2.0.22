import{d as P,m as r,$ as x,o as C,x as V,Q as k,aI as w,r as y,a as c,g as p,b as m,e as g,u as l,i as T,F as A,j as R,aQ as b,n as M,h as B,t as Q,aR as U,p as q,q as E,K as F}from"./main-BnXXyOo5.js";import{T as Y}from"./TaskCard-DN6TrCgP.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={key:0,class:"step-name"},W={class:"status-div"},$=P({__name:"TaskApply",setup(j){const a=r(!1),i=r(!1),d=r(!1),t=x({page:1,start:0,limit:10,byYear:1,Year:new Date().getFullYear(),historyTaskType:"MyRequest"}),D=r(0),n=r([]),u=async()=>{a.value&&(a.value=!1,n.value.length=0),t.start=(t.page-1)*t.limit;const e={...t,..._.value},{success:o,errorMessage:f,data:v}=await q(E.getRequstTask.url,e);if(!o){F(f,"danger");return}const{total:s,children:I}=v,h=I;D.value=s,e.page==1&&(n.value=[]),n.value.push(...h),(n.value.length>=s||h.length<=0)&&(d.value=!0),t.page+=1,i.value=!1},S=e=>({ProcessId:e.ProcessId,ProcessName:e.ProcessName,ProcessVersion:e.ProcessVersion,ProcessIcon:e.ProcessIcon,SerialNum:e.SerialNum,CreateAt:e.CreateAt,Description:e.Description,OwnerDisplayName:e.OwnerDisplayName,AgentDisplayName:e.AgentDisplayName,TaskID:e.TaskID,StepID:e.StepID}),N=()=>{a.value=!0,t.page=1,u()},_=r({});return C(()=>{u(),V(()=>{k.on("onTask_apply",e=>{_.value=e.value,t.page=1,a.value=!0,n.value.length=0,d.value=!1,u()})})}),w(()=>{k.off("onTask_apply")}),(e,o)=>{const f=y("van-list"),v=y("van-pull-refresh");return p(),c("div",null,[m(v,{modelValue:l(a),"onUpdate:modelValue":o[1]||(o[1]=s=>T(a)?a.value=s:null),onRefresh:N},{default:g(()=>[m(f,{loading:l(i),"onUpdate:loading":o[0]||(o[0]=s=>T(i)?i.value=s:null),finished:l(d),"immediate-check":!1,"finished-text":e.$t("Work.NoMore"),onLoad:u},{default:g(()=>[(p(!0),c(A,null,R(l(n),s=>(p(),c("div",{key:s.ProcessId},[m(Y,{process:S(s),"task-type":l(b).REQUEST},{default:g(()=>[s.State&&s.State.children?(p(),c("div",O,[B("div",W,Q(l(U)[s.State.State]),1)])):M("",!0)]),_:2},1032,["process","task-type"])]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])}}}),H=L($,[["__scopeId","data-v-792f512c"]]);export{H as default};
