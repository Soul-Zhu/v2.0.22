import{d as H,c as K,m as y,w as W,a as u,b as d,e as g,r as i,g as r,h as c,n as k,l as V,F as x,j as U,v as B,p as w,q as N,k as A,s as $,t as C,x as X}from"./main-BnXXyOo5.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"path-line"},te=["onClick"],se={key:0,class:"select-user"},ne=["onClick"],oe={class:"item-cont"},le={class:"item-cont-inner"},re=["onClick"],ce={class:"item-cont"},ue={class:"item-cont-inner"},ie={class:"check"},ve=H({__name:"YZMemberSelect",props:{show:{type:Boolean,required:!0,default:!0},multiple:{type:Boolean,required:!1,default:!1},defaultUsers:{type:Array,required:!1,default:[]}},emits:["update:show","onSave"],setup(O,{emit:E}){const b=O,f=K(()=>b.show),S=E,q=()=>{l.value=[],n.value=[],S("update:show",!1),p()},M=()=>{S("onSave",l.value),l.value=[],m.value="",p(),S("update:show",!1)},m=y(""),n=y([]),v=y([]),l=y([]),p=async()=>{const{data:e}=await w(N.getOrgs.url);v.value=e.map(a=>({type:"ou",...a})),n.value=[{name:"全部",ouid:"all",icon:!1,providerName:"",code:"",sid:"",level:""}]},F=async e=>{const a=N.getOrgChildren.url.toFetchUrl({params1:e.providerName,params2:e.ouid}),{data:o}=await w(a);v.value=o.map(t=>({type:"ou",...t})),I({name:e.text,icon:!1,ouid:e.ouid,providerName:e.providerName,code:e.code,sid:e.sid,level:e.ouLevel}),R(e)},D=e=>{e.ouid==="all"?(p(),n.value=[{name:"全部",ouid:"all",icon:!1,providerName:"",code:"",sid:"",level:""}]):F({code:e.code,sid:e.sid,name:e.name,text:e.name,providerName:e.providerName,ouid:e.ouid,level:e.level})},G=e=>{const{userAccount:a,userShortName:o}=e;b.multiple?l.value.find(h=>h.userAccount===a)||l.value.push(e):(l.value=[],l.value.push(e))},I=e=>{const a=n.value.find(t=>t.name===e.name),o=[];if(a){for(let t=0;t<n.value.length;t++)if(n.value[t].name===e.name){o.push({icon:!1,name:e.name,ouid:e.ouid,code:e.code,level:e.level,sid:e.sid,providerName:e.providerName});break}else o.push({icon:!0,name:n.value[t].name,ouid:n.value[t].ouid,code:n.value[t].code,level:n.value[t].level,sid:n.value[t].sid,providerName:n.value[t].providerName});n.value=o}else n.value.forEach(t=>{t.icon=!0}),n.value.push(e)},L=async()=>{if(!m.value)p();else{const{data:e}=await w(N.getSearchMembers.url.toFetchUrl({}),{wd:m.value,page:1,start:0,limit:1e3});v.value=[],e.forEach(a=>{v.value.push({type:"user",...a})})}},T=()=>{p()},J=e=>l.value.find(o=>o.userAccount===e)!==void 0,P=e=>{const a=l.value.findIndex(o=>o.userAccount===e.userAccount);a>-1&&l.value.splice(a,1)},R=async e=>{const a=N.getOrgMembers.url.toFetchUrl({params1:e.providerName,params2:e.ouid}),{data:o}=await w(a);o&&o.length>0&&o.forEach(t=>{v.value.push({type:"user",...t})})};return W(()=>f.value,()=>{X(()=>{f.value&&(p(),l.value=JSON.parse(JSON.stringify(b.defaultUsers)))})}),(e,a)=>{const o=i("van-nav-bar"),t=i("van-search"),h=i("van-icon"),Y=i("van-tag"),Z=i("van-cell"),j=i("van-cell-group"),Q=i("van-empty"),z=i("van-popup");return r(),u("div",null,[d(z,{show:f.value,"onUpdate:show":a[1]||(a[1]=s=>f.value=s),teleport:"body",position:"bottom",style:{height:"100%"}},{default:g(()=>[d(o,{title:e.$t("Form.Users"),"left-text":e.$t("Global.Cancle"),"right-text":e.$t("Global.Enter"),"left-arrow":"",onClickRight:M,onClickLeft:q},null,8,["title","left-text","right-text"]),c("div",null,[d(t,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=s=>m.value=s),placeholder:e.$t("Form.SearchUser"),onSearch:L,onClear:T,style:{padding:"0px",width:"95%",margin:"0px auto"}},null,8,["modelValue","placeholder"])]),c("div",ae,[(r(!0),u(x,null,U(n.value,s=>(r(),u("div",{class:"li-div",key:s.name,onClick:_=>D(s)},[A(C(s.name)+" ",1),s.icon?(r(),$(h,{key:0,name:"arrow",style:{"margin-left":"-13px"}})):k("",!0)],8,te))),128))]),l.value.length>0?(r(),u("div",se,[(r(!0),u(x,null,U(l.value,(s,_)=>(r(),$(Y,{key:_,class:"user-tag",closeable:"",type:"primary",plain:"",onClose:de=>P(s)},{default:g(()=>[A(C(s.userShortName),1)]),_:2},1032,["onClose"]))),128))])):k("",!0),d(j,null,{default:g(()=>[c("div",null,[(r(!0),u(x,null,U(v.value,s=>(r(),$(Z,{key:s.text},{default:g(()=>[s.type==="ou"?(r(),u("div",{key:0,class:"item",onClick:_=>F(s)},[a[2]||(a[2]=c("i",{class:"fa fa-sitemap folder-icon"},null,-1)),c("div",oe,[c("div",le,C(s.text),1)])],8,ne)):k("",!0),s.type==="user"?(r(),u("div",{key:1,class:"item",onClick:_=>G(s)},[d(h,{class:"item-icon",name:"manager-o"}),c("div",ce,[c("div",ue,[A(C(s.userShortName)+" ",1),c("div",ie,[V(d(h,{name:"success",color:"#1889fa"},null,512),[[B,J(s.userAccount)]])])])])],8,re)):k("",!0)]),_:2},1024))),128))])]),_:1}),V(d(Q,{description:e.$t("Form.DepartNoUser")},null,8,["description"]),[[B,v.value.length<=0]])]),_:1},8,["show"])])}}}),he=ee(ve,[["__scopeId","data-v-dcf1541b"]]);export{he as default};
