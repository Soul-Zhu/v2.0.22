import{d as Z,L as k,m,M as G,o as I,x as L,w as P,J as Q,K as D,Q as f,a as T,l as j,v as z,u as n,h as J,b as y,e as _,R as A,i as x,r as C,G as X,g as N,s as ee,n as ae,k as le,t as se,q as $,I as te,p as oe}from"./main-BnXXyOo5.js";import ne from"./YZOrgSelect-CbvC4m2r.js";import{_ as ue}from"./YZChangeFieldTag.vue_vue_type_style_index_0_lang-CU_sMXjx.js";import{u as ie}from"./formWatch-KqHO0hI-.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./encodeext-DBC3bVZy.js";import"./useFormEnv-VwQXjqJl.js";import"./useInitFieldState-EKN-2KHT.js";const re=Z({__name:"YZOu",props:k({cfg:{},formRow:{}},{modelValue:{type:String},modelModifiers:{}}),emits:k(["update:field"],["update:modelValue"]),setup(w,{emit:K}){const p=m([]),i=m(),r=G(w,"modelValue"),d=w,l=m(d.cfg),{WatchChageExpress:E,WatchSelfExpress:B}=ie();I(()=>{L(async()=>{W(),await b(),B(l.value,d.formRow,e=>{r.value=e,b()},e=>{l.value.hidden=e,c("update:field",l.value)},e=>{l.value.disabled=e,c("update:field",l.value)},e=>{l.value.hidden=e,c("update:field",l.value)})})}),P(()=>r.value,async(e,a)=>{E(d.cfg,e,d.formRow),e&&await V(e)});const v=m(!1),R=()=>{d.cfg.disabled||(v.value=!0)},b=async()=>{r.value&&await V(r.value)},V=async e=>{const a=await S(e);if(a&&a.length>0){const s=a[0];i.value=s.text}},F=async e=>{if(e&&e.length>0){const a=e[0],s=await S(a.modelValue);if(s&&s.length>0){const o=s[0];i.value=o.text,r.value=a.modelValue;const t=await q(o.ouid);t&&g(t),p.value.push({name:a.name,code:a.code,modelValue:a.modelValue,ouid:a.ouid})}}else i.value="",r.value="",p.value=[],g(null)},S=async e=>{const a=$.getOrgSimple.url,{success:s,data:o,errorMessage:t}=await Q(a,{ouids:[e],showFullPath:!0});return s?o:(D(t,"danger"),null)},q=async e=>{const a=$.getOrgMapData.url.toFetchUrl({params1:e}),{success:s,data:o,errorMessage:t}=await oe(a);return s?o:(D(t,"danger"),null)},{setFormValue:M}=te(),g=e=>{const a=d.cfg.map;if(!a)return;const s=Object.keys(a);if(s.length>0)if(e){const o=e.ou;s.forEach(t=>{const h=t,u=a[t],Y=U(o,h);M(d.cfg,u,Y)})}else s.forEach(o=>{const t=a[o];M(d.cfg,t,"")})},U=(e,a)=>{const s=a.split(".");let o=e;for(const t of s)o=o[t];return o??""},H=()=>{i.value="",r.value="",p.value=[],g(null)},c=K,O=m(""),W=()=>{const e=l.value,a=`setDisabled_${e.uuid}_${e.fullKey}`,s=`setHidden_${e.uuid}_${e.fullKey}`,o=`setColumnHidden_${e.uuid}_${e.fullKey}`,t=`setRules_${e.uuid}_${e.fullKey}`,h=`setClose_${e.uuid}`;f.on(a,u=>{l.value.disabled=u,c("update:field",l.value)}),f.on(s,u=>{l.value.hidden=u,c("update:field",l.value)}),f.on(o,u=>{l.value.hidden=u,c("update:field",l.value)}),f.on(t,u=>{l.value.rules=[u],c("update:field",l.value)}),f.on(h,u=>{O.value=u})};return(e,a)=>{const s=C("van-tag"),o=C("van-field");return N(),T("div",{class:X(n(O))},[j(J("div",null,[y(o,{eadonly:"",name:n(l).bindModel,label:n(l).fieldLabel,placeholder:n(l).placeholder,required:n(l).required,rules:n(l).rules,disabled:n(l).disabled,clickable:"","is-link":!n(l).disabled,modelValue:n(i),"onUpdate:modelValue":a[0]||(a[0]=t=>x(i)?i.value=t:null),onClick:A(R,["stop"])},{input:_(()=>[n(i)?(N(),ee(s,{key:0,closeable:!n(l).disabled,class:"user-tag",type:"primary",plain:"",onClose:H},{default:_(()=>[le(se(n(i)),1)]),_:1},8,["closeable"])):ae("",!0)]),button:_(()=>[y(ue,{field:n(l)},null,8,["field"])]),_:1},8,["name","label","placeholder","required","rules","disabled","is-link","modelValue"]),y(ne,{show:n(v),"onUpdate:show":a[1]||(a[1]=t=>x(v)?v.value=t:null),defaultOrgs:n(p),onOnSave:F},null,8,["show","defaultOrgs"])],512),[[z,!n(l).hidden]])],2)}}}),_e=de(re,[["__scopeId","data-v-0c009ad7"]]);export{_e as default};
