import{d as O,L as D,D as $,M as ee,m as E,O as se,o as te,x as ne,Q as g,w as ae,a as x,l as P,h as u,v as Z,u as o,b as W,e as ie,r as _,F as le,j as oe,G as de,J as re,q as p,g as I,n as ce,t as b,R as ue,S as V,K as U,p as F,T as h}from"./main-BnXXyOo5.js";import{p as pe,_ as B}from"./wecom.prod-DVLinVsr.js";import{u as me}from"./formWatch-KqHO0hI-.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useFormEnv-VwQXjqJl.js";import"./encodeext-DBC3bVZy.js";import"./useInitFieldState-EKN-2KHT.js";const ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABZCAMAAABi1XidAAAA51BMVEUAAABns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2pns2r////3+/fZ7Nr9/v202rVptGy/38BxuHRrtW7R6NJ1undtt3D5/Pnr9euRyJPv+PCbzZ2OxpCCwYXz+fPk8uXf7+C33Lmw2LGp1Kun06ifz6GUypZ7vn7t9u3i8OLc7t3Y7NnD4cS63bx/v4F4vHr7/fvN5s7L5czF4saJxIuFwojl8ubX69jT6tTG48es1q6j0qWazZyXy5mLxY2ZSHjkAAAAGHRSTlMAoNDJUSH545mPflwu7uze07avaks9GQ1NRPDXAAAC+ElEQVRYw+2ZZ2/qMBSG3dvSffdyKAl7771poWWV/v/fc8XxTlTJtoh0VeX9QvIoPEmOj00i0DH3t9dnJ8v17W9E8+c7PnHOYyCOXeGT5/P90XyOQ8g3hNAFDiUXCJ3hUHIDxQgjZwh9go3IHJkjc2SOzJE5BHP2AVL14Q7QtafS9Bjwm94115xjdj5adyAVlVYIneuZH+HgjQr7DklSxS7Agmad23B03gvCoGQEcKtprhKHWruxQ6PUP5cAttc0e3E4vCWzFCgCuEjYTLfrMnD4WEZlh2Uk4yagmnY/t+D4RVoZVZZEVsINQI/a5lWgwdJxh6cbKHNH25zOwxfcQD39V9ijg6ptxg/+iiYlc1xUaUqAp292SUVzHJQADIi6yPEQ9jNY31z0KZ7J/p5UO+lrxZauWYzMVL0HZ54hl87wgeCVrll001BdjV5wR4yYqH4+bWKekkKnlNVoimfqNKzTGaVtFu10oKsRL3sBNhq0zAS7RuaUsmSO+V1PCM8CfqUnNDCLysotsBGyvVTmRM7MnGQXJ1ajNjmJ6OAXWhoDs7CVj9tP0lLZEO2QpeNqYhZfm4jVaCB3dk+cvGdmZl1QEBNyAviN7fDRTJmat3Ta8ZIf5N+bEj93HZuau3wxLiktkCH8Gc9pY5qZxbzbstXoQf0Nd9mpy8ZmXKK37Sozmk3wIV7SvjQ0i17r19nt0wzoAAzoEBub2brWJB81j/GlwpemZvE8syAfT5y/KrxrYfZqDo1qSDly+sZm0V+BgWpIuIRtzDvJMAw8F9EiWZlXkqEp8YrEO1ZmLy8MFYmnJV61MuM1F6jPKhvOa56d2eWGjMLbErczV94p54zznaU5l3ina0uMr2zM4iUkuDgsKc97tuam8j4VfAFYY1tzjxp6Pp6l3LUzi2eAReCJYki73NqMR/Fjgr3lAq/l/ps3+siMI3Nk/hjm8P5d+oFDyQ1CP3EouUDo7xccQq5QWH89/kLH3F2e2nt5h0hi11en1H69iaFQ8w+14tq/lkGE5QAAAABJRU5ErkJggg==",Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABZCAMAAABi1XidAAAAYFBMVEUAAAD1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn1sWn////3wIX2tnL+9u3++vb2u3z+9u73xI31s2398+f4x5P3v4Okad8eAAAAE3RSTlMAoIDQevqZDM+7GV81JbKoj2xLsJHNvgAAANtJREFUWMPt2MsOgjAQheGjFgS8OyLi9f3fUgLpxEVjNHbEyPlX5Cy+sKFNQNN8mUjM8i26nEQvbeGNGDRu4CIRg5IF4MQkB+Ri0gjIpM1AnrQPlClTpvyZXB98lW77gxba9i/KO9+DstNCG2XKA5TPpe9a+Y66nQJb+fa5UT9/U9EoUx6gXFe+S/jL003r/dygTPmfZN6DlCnzHvydE4ky5T7vwZtopRbaev+PRJky5e/JuZiUAmsxyQFzMWkBYCUGjdA0zeLD2RQtnUZ2k7SBu4qZG0fLzQrYdgd85zc1/XN0RQAAAABJRU5ErkJggg==",ge={class:"image-container"},he={class:"file-content"},we=["onClick"],ye=["src"],xe={class:"file-info"},Ie={class:"file-name"},Ue={class:"file-size"},Ne=["onClick"],Ee=O({__name:"YZAttachment",props:D({cfg:{},formRow:{}},{modelValue:{type:String},modelModifiers:{}}),emits:D(["update:field"],["update:modelValue"]),setup(z,{emit:Q}){const S=$(),r=ee(z,"modelValue"),w=z,t=E(w.cfg),m=E([]),L=e=>{const s=m.value;e.forEach(n=>{s.push(n)}),m.value=s,r.value=s.map(n=>n.fileId).join(",")},R=e=>{const s=m.value.filter(n=>n.fileId!==e.fileId);m.value=s,r.value=s.map(n=>n.fileId).join(",")},J=(e,s)=>{for(var n=["KB","MB","GB","TB"],l=Math.ceil(e/1024)+" "+n[0],a=1;a<n.length;a++){var i=(e/Math.pow(1024,a+1)).toFixed(2);if(i<1)return l;l=i+" "+n[a]}return l},A=se(),y=[".jpg",".png",".jpeg"],k=[],H=e=>{if(A==="H5")if(y.includes(e.ext)){const s=f(e.fileId);V([s])}else{const s=f(e.fileId);window.open(s)}else if(A==="WECHAT"){const s=f(e.fileId);console.log("url:",s),pe({url:s,size:e.size,name:e.fileName}).then(n=>{n.errCode!==0&&U(n.errMsg,"danger")}).catch(n=>{const l=JSON.stringify(n);U(l,"danger")})}else if(A==="DINGTALK")if(y.includes(e.ext)){const s=f(e.fileId);V([s])}else F(p.setPreviewById.url,{fileId:e.fileId}).then(async s=>{const{url:n,virtualId:l}=s.data.data;if(n){let a=window.location.pathname;a.endsWith("/")&&(a=a.substring(0,a.length-1)),B.downloadFile({url:window.location.origin+a+n,success:async function(i){const{filePath:d}=i,c=e.ext.startsWith(".")?e.ext.substring(1):e.ext;if(c==="txt"){const N=window.location.origin+a+"/preview.html?view="+n;B.openLink({url:N,success:async()=>{const X=setTimeout(()=>{h(p.deletePreviewById.url.toFetchUrl({params1:l})),clearTimeout(X)},5e3)},fail:()=>{U("钉钉打开txt链接失败,钉钉不支持","danger")},complete:()=>{h(p.deletePreviewById.url.toFetchUrl({params1:l}))}})}else await h(p.deletePreviewById.url.toFetchUrl({params1:l})),B.openDocument({filePath:d,fileType:c,success:function(N){},fail:function(N){U(`${c}格式暂不支持预览`,"danger")}})},fail:async function(i){await h(p.deletePreviewById.url.toFetchUrl({params1:l})),console.log("文件下载失败",i)}})}});else if(A==="FEISHU")window.tt.openSchema({schema:f(e.fileId)});else if(A==="UNIAPP")if(y.includes(e.ext)){const s=f(e.fileId);V([s])}else F(p.setPreviewById.url,{fileId:e.fileId}).then(async s=>{const{url:n,virtualId:l}=s.data.data;if(n){let a=window.location.pathname;a.endsWith("/")&&(a=a.substring(0,a.length-1));const i=window.location.origin+a+n;try{k.push(l),window.uni.postMessage({data:{action:"openDocument",url:i}}),G()}catch(d){console.log("errorr",d)}}})};let C=0;const G=()=>{C===0&&(C=setInterval(()=>{const e=k.pop();e&&h(p.deletePreviewById.url.toFetchUrl({params1:e}))},5e3))},f=e=>{const s=window.location.pathname.replace("index.html","");return`${window.location.origin}${s}bpm/attachment/file/${e}?access_token=${S.getToken}`},{WatchChageExpress:T,WatchSelfExpress:K}=me(),v=Q,M=async e=>{if(!e)return;const s=e.split(",");m.value=await q(s)};te(()=>{ne(async()=>{M(r.value),Y(),K(t.value,w.formRow,e=>{},e=>{t.value.hidden=e,v("update:field",t.value)},e=>{t.value.disabled=e,v("update:field",t.value)},e=>{t.value.hidden=e,v("update:field",t.value)})})});const j=E(""),Y=()=>{const e=t.value,s=`setDisabled_${e.uuid}_${e.fullKey}`,n=`setHidden_${e.uuid}_${e.fullKey}`,l=`setColumnHidden_${e.uuid}_${e.fullKey}`,a=`setRules_${e.uuid}_${e.fullKey}`,i=`setClose_${e.uuid}`;g.on(s,d=>{t.value.disabled=d,v("update:field",t.value)}),g.on(n,d=>{t.value.hidden=d,v("update:field",t.value)}),g.on(l,d=>{t.value.hidden=d,v("update:field",t.value)}),g.on(a,d=>{t.value.rules=[d],v("update:field",t.value)}),g.on(i,d=>{j.value=d})};ae(()=>r.value,(e,s)=>{T(w.cfg,e,w.formRow),e!=s&&e&&M(e)});const q=async e=>{const s=new FormData;e.forEach(a=>{s.append("fileIds",a)});const n=[],{data:l}=await re(p.getAttachmentInfo.url,s);if(l&&l.length>0)for(let a=0;a<l.length;a++){const i=l[a].fileId,d=f(i),c={...l[a]};c.preview=d,n.push(c)}return n};return(e,s)=>{const n=_("YZUploader"),l=_("van-field"),a=_("van-icon");return I(),x("div",{class:de(o(j))},[P(u("div",null,[P(W(l,{name:o(t).bindModel,label:o(t).fieldLabel,placeholder:o(t).placeholder,required:o(t).required,rules:o(t).rules,disabled:o(t).disabled,modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=i=>r.value=i)},{input:ie(()=>[u("div",ge,[W(n,{disabled:o(t).disabled,"file-type":"files",modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=i=>r.value=i),fileListData:o(m),maxSize:o(t).fileSize,onAfterUpload:L,size:o(t).sizeUnit,fileTypes:o(t).fileTypes,maxLimit:o(t).maxLimit},null,8,["disabled","modelValue","fileListData","maxSize","size","fileTypes","maxLimit"])])]),_:1},8,["name","label","placeholder","required","rules","disabled","modelValue"]),[[Z,!o(t).hidden]])],512),[[Z,!o(t).hidden]]),u("div",he,[(I(!0),x(le,null,oe(o(m),(i,d)=>(I(),x("div",{class:"file-item",key:i.fileId},[u("div",{class:"file-item-card",onClick:c=>H(i)},[u("img",{src:y.includes(i.ext)?o(Ae):o(ve),width:"30",height:"30",alt:""},null,8,ye),u("div",xe,[u("div",Ie,b(i.fileName),1),u("div",Ue,b(J(i.size)),1)]),o(t).disabled?ce("",!0):(I(),x("div",{key:0,class:"file-delete",onClick:ue(c=>R(i),["stop"])},[W(a,{name:"clear"})],8,Ne))],8,we)]))),128))])],2)}}}),Me=fe(Ee,[["__scopeId","data-v-76577168"]]);export{Me as default};
