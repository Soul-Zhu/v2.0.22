import{d as I,L as y,M as R,m as _,W as Z,c as Y,o as L,Z as O,x as W,Q as w,l as j,v as G,u as o,a as K,h as U,s as z,b as H,e as Q,r as x,g as D,k as q,t as A,P as J,y as X}from"./main-BnXXyOo5.js";import{u as ee}from"./useFormEnv-VwQXjqJl.js";import{u as te}from"./formWatch-KqHO0hI-.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./encodeext-DBC3bVZy.js";import"./useInitFieldState-EKN-2KHT.js";const ae={class:"data-btn"},se=I({__name:"YZGridTdatabrowserbtn",props:y({cfg:{},formRow:{},rowId:{}},{modelValue:{type:String},modelModifiers:{}}),emits:y(["update:field"],["update:modelValue"]),setup(b,{emit:E}){const{WatchSelfExpress:V}=te(),{getFormEnv:C}=ee(),F=C(),h=R(b,"modelValue"),S=_(""),P=Z(),s=b,e=_(s.cfg),N=Y(()=>P.getCurrentFormId),u=_(!1);L(async()=>{F===O.POST&&h.value&&(S.value=h.value),W(()=>{M(),V(e.value,s.formRow,t=>{},t=>{e.value.hidden=t,i("update:field",e.value)},t=>{e.value.disabled=t,i("update:field",e.value)},t=>{})})});const T=()=>{if(!s.cfg.disabled){if(!s.cfg.ds){J({type:"danger",message:X("Form.unConfigDs")});return}u.value=!0}},g=t=>{u.value=t},$=async t=>{const d=s.cfg;if(!d.ds)return;const n=d.ds.map,a=Object.keys(n),l={};a.forEach(m=>{const f=n[m];if(f.indexOf(".")>-1){const c=f.split(".")[0],k=f.split(".")[1];if(l[c]){let r=0;for(const p of t){const v=p[m];l[c][r][k]=v,r++}}else{l[c]=[];for(const r of t){const p=r[m],v={[k]:p};l[c].push(v)}}}}),g(!1);const B=`addRow_${N.value}_${s.rowId}`;w.emit(B,l)},i=E,M=()=>{const t=e.value,d=`setDisabled_${t.uuid}_${t.fullKey}`,n=`setHidden_${t.uuid}_${t.fullKey}`;w.on(d,a=>{e.value.disabled=a,i("update:field",e.value)}),w.on(n,a=>{e.value.hidden=a,i("update:field",e.value)})};return(t,d)=>{const n=x("van-button"),a=x("YZDataDialog");return j((D(),K("div",null,[U("div",ae,[H(n,{icon:"search",size:"small",block:"",onClick:T,disabled:o(e).disabled},{default:Q(()=>[q(A(o(e).fieldLabel),1)]),_:1},8,["disabled"])]),(D(),z(a,{showPicker:o(u),title:o(e).dialogTitle,ds:o(e).ds,currentField:o(e),viewColumns:o(e).viewColumns,onUpdatePicker:g,multiple:!0,"onUpdate:field":$,key:Math.random()},null,8,["showPicker","title","ds","currentField","viewColumns"]))],512)),[[G,!o(e).hidden]])}}}),ue=oe(se,[["__scopeId","data-v-69c9149f"]]);export{ue as default};
