import{d as q,L as k,M as F,D as K,m as _,w as x,o as Y,x as Z,Q as m,a as v,l as L,v as N,u as t,h as p,b as w,e as j,r as g,G as A,J as H,q as W,g as h,F as T,j as z,n as G,R as J,S as Q}from"./main-BnXXyOo5.js";import{u as O}from"./formWatch-KqHO0hI-.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useFormEnv-VwQXjqJl.js";import"./encodeext-DBC3bVZy.js";import"./useInitFieldState-EKN-2KHT.js";const ee={class:"image-container"},ae={class:"image-row"},se=["onClick"],le={key:0,class:"delete-icon"},te=["src","alt"],oe=q({__name:"YZImageattachment",props:k({cfg:{},formRow:{}},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:k(["update:field"],["update:modelValue"]),setup(b,{emit:D}){const d=F(b,"modelValue"),E=K(),f=b,a=_(f.cfg);x(()=>d.value,async e=>{if(e){const s=e.split(",");u.value=await $(s)}});const u=_([]),M=e=>{const s=u.value;e.forEach(l=>{l.preview=y(l.fileId),s.push(l)}),u.value=s,d.value=s.map(l=>l.fileId).join(",")},R=e=>{const s=[];u.value.forEach(l=>{l.preview&&e.fileId!==l.fileId&&s.push(l.preview)}),e.preview&&s.unshift(e.preview),Q(s)},S=e=>{const s=u.value.filter(l=>l.fileId!==e.fileId);u.value=s,d.value=s.map(l=>l.fileId).join(",")},y=e=>window.webConfig.host+`bpm/attachment/file/${e}?access_token=${E.getToken}`,I=async e=>{if(!e)return;const s=e.split(",");u.value=await $(s)},{WatchChageExpress:U,WatchSelfExpress:B}=O(),r=D;Y(async()=>{Z(async()=>{I(d.value),P(),B(a.value,f.formRow,e=>{},e=>{a.value.hidden=e,r("update:field",a.value)},e=>{a.value.disabled=e,r("update:field",a.value)},e=>{a.value.hidden=e,r("update:field",a.value)})})});const C=_(""),P=()=>{const e=a.value,s=`setDisabled_${e.uuid}_${e.fullKey}`,l=`setHidden_${e.uuid}_${e.fullKey}`,c=`setColumnHidden_${e.uuid}_${e.fullKey}`,n=`setRules_${e.uuid}_${e.fullKey}`,o=`setClose_${e.uuid}`;m.on(s,i=>{a.value.disabled=i,r("update:field",a.value)}),m.on(o,i=>{C.value=i}),m.on(l,i=>{a.value.hidden=i,r("update:field",a.value)}),m.on(c,i=>{a.value.hidden=i,r("update:field",a.value)}),m.on(n,i=>{a.value.rules=[i],r("update:field",a.value)})};x(()=>d.value,(e,s)=>{U(f.cfg,e,f.formRow),e!=s&&e&&I(e)});const $=async e=>{const s=new FormData;e.forEach(n=>{s.append("fileIds",n)});const l=[],{data:c}=await H(W.getAttachmentInfo.url,s);if(c&&c.length>0)for(let n=0;n<c.length;n++){const o=c[n].fileId,i=y(o),V={...c[n]};V.preview=i,l.push(V)}return l};return(e,s)=>{const l=g("van-icon"),c=g("YZUploader"),n=g("van-field");return h(),v("div",{class:A(t(C))},[L(p("div",null,[L(w(n,{name:t(a).bindModel,label:t(a).fieldLabel,placeholder:t(a).placeholder,required:t(a).required,rules:t(a).rules,disabled:t(a).disabled,modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=o=>d.value=o)},{input:j(()=>[p("div",ee,[p("div",ae,[(h(!0),v(T,null,z(t(u),o=>(h(),v("div",{class:"image-div",key:o.fileId,onClick:i=>R(o)},[t(a).disabled?G("",!0):(h(),v("div",le,[w(l,{name:"cross",class:"cross-icon",onClick:J(i=>S(o),["stop"])},null,8,["onClick"])])),p("img",{src:o.preview,alt:o.fileName,width:"50",height:"50"},null,8,te)],8,se))),128))]),w(c,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=o=>d.value=o),maxLimit:t(a).maxLimit,fileListData:t(u),disabled:t(a).disabled,"file-type":"image",onAfterUpload:M},null,8,["modelValue","maxLimit","fileListData","disabled"])])]),_:1},8,["name","label","placeholder","required","rules","disabled","modelValue"]),[[N,!t(a).hidden]])],512),[[N,!t(a).hidden]])],2)}}}),me=X(oe,[["__scopeId","data-v-13dc39c1"]]);export{me as default};
