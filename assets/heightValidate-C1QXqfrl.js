import{p as h,u as E}from"./formWatch-KqHO0hI-.js";import{I as G,ah as W,ai as x,W as M,Q as i,a4 as I}from"./main-BnXXyOo5.js";import{u as S}from"./encodeext-DBC3bVZy.js";const{isEmpty:m}=S(),B=M(),D=()=>{const F=(e,a)=>{const f=B.getCurrentFormId,C=B.getRuningPlainsCfg(f);return new Promise(($,p)=>{let R=0;for(const b of C)if(b.validators&&b.validators.length>0)for(const u of b.validators){const{type:l}=u;switch(l){case"required":R+=K(b,u,e);break;case"express":R+=_(b,u,e);break;case"custom":R+=P(b,u,e);break}}$(R)})},K=(e,a,f,C)=>{var u;const{filterProcess$vars:$,WatchProcessConst:p}=E(),{getFormValue:R}=G();let b=!1;if(a.$disable){const l=h.paserExpressExt.parse(a.$disable);if(l&&l.length>0){const t={};for(const o of l)if($.includes(o))t[o]=p(o);else{const s=R(e,o);W(s)?t[o]=x(s):t[o]=s}let r=h.paserExpressExt.evaluate(t,a.$disable);Array.isArray(r)&&(r=r.toString()),Number(r)>0||isNaN(Number(r))?b=!0:b=!!r}else{let t=a.$disable;Number(t)>0||isNaN(Number(t))?b=!0:b=!!t}}if(b){const l=R(e,e.fullKey);if(!e.canWirte&&!e.fieldRequeired&&e.forceValidation&&e.disabled)return n(!1,e);if(!e.canWirte&&!e.fieldRequeired&&!e.forceValidation&&e.disabled)return n(!1,e);if(!e.canWirte&&e.fieldRequeired&&e.forceValidation&&e.disabled)return m(l)?n(!0,e):0;if(!e.canWirte&&e.fieldRequeired&&!e.forceValidation&&e.disabled)return n(!1,e);if(e.canWirte&&!e.fieldRequeired&&e.forceValidation&&e.disabled)return n(!1,e);if(e.canWirte&&!e.fieldRequeired&&!e.forceValidation&&e.disabled)return n(!1,e);if(e.canWirte&&!e.fieldRequeired&&e.forceValidation&&!e.disabled)return n(!1,e);if(e.canWirte&&!e.fieldRequeired&&!e.forceValidation&&!e.disabled)return n(!1,e);if(e.canWirte&&e.fieldRequeired&&e.forceValidation&&e.disabled)return m(l)?n(!0,e):0;if(e.canWirte&&e.fieldRequeired&&!e.forceValidation&&e.disabled)return n(!1,e);if(e.canWirte&&e.fieldRequeired&&e.forceValidation&&!e.disabled)return m(l)?n(!0,e):0;if(e.canWirte&&e.fieldRequeired&&!e.forceValidation&&!e.disabled)return m(l)?n(!0,e):0}else if((((u=f.validationGroup)==null?void 0:u.split(","))||[]).includes(a.validationGroup)||a.validationGroup==null){const t=R(e,e.fullKey);if(!e.canWirte&&!e.fieldRequeired&&e.forceValidation&&e.disabled)return n(!1,e);if(!e.canWirte&&!e.fieldRequeired&&!e.forceValidation&&e.disabled)return n(!1,e);if(!e.canWirte&&e.fieldRequeired&&e.forceValidation&&e.disabled)return m(t)?n(!0,e):0;if(!e.canWirte&&e.fieldRequeired&&!e.forceValidation&&e.disabled)return n(!1,e);if(e.canWirte&&!e.fieldRequeired&&e.forceValidation&&e.disabled)return m(t)?n(!0,e):0;if(e.canWirte&&!e.fieldRequeired&&!e.forceValidation&&e.disabled)return n(!1,e);if(e.canWirte&&!e.fieldRequeired&&e.forceValidation&&!e.disabled)return m(t)?n(!0,e):0;if(e.canWirte&&!e.fieldRequeired&&!e.forceValidation&&!e.disabled)return m(t)?n(!0,e):0;if(e.canWirte&&e.fieldRequeired&&e.forceValidation&&e.disabled)return m(t)?n(!0,e):0;if(e.canWirte&&e.fieldRequeired&&!e.forceValidation&&e.disabled)return n(!1,e);if(e.canWirte&&e.fieldRequeired&&e.forceValidation&&!e.disabled)return m(t)?n(!0,e):0;if(e.canWirte&&e.fieldRequeired&&!e.forceValidation&&!e.disabled)return m(t)?n(!0,e):0}return 0},_=(e,a,f)=>{var b;const{filterProcess$vars:C,WatchProcessConst:$}=E(),{getFormValue:p}=G();let R=!1;if(a.$disable){const u=h.paserExpressExt.parse(a.$disable);if(u&&u.length>0){const l={};for(const r of u)if(C.includes(r))l[r]=$(r);else{const o=p(e,r);W(o)?l[r]=x(o):l[r]=o}let t=h.paserExpressExt.evaluate(l,a.$disable);Array.isArray(t)&&(t=t.toString()),Number(t)>0||isNaN(Number(t))?R=!0:R=!!t}else{let l=a.$disable;Number(l)>0||isNaN(Number(l))?R=!0:R=!!l}}if(R){const u=p(e,e.fullKey),l=`setRules_${e.uuid}_${e.fullKey}`;if(!e.disabled&&e.fieldRequeired&&e.forceValidation)return m(u)?(i.emit(l,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(l,{}),0);if(!e.disabled&&e.fieldRequeired&&!e.forceValidation)return m(u)?(i.emit(l,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(l,{}),0);if(!e.disabled&&!e.fieldRequeired&&e.forceValidation)return i.emit(l,{}),0;if(!e.disabled&&!e.fieldRequeired&&!e.forceValidation)return i.emit(l,{}),0;if(e.disabled&&e.fieldRequeired&&e.forceValidation)return m(u)?(i.emit(l,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(l,{}),0);if(e.disabled&&e.fieldRequeired&&!e.forceValidation)return i.emit(l,{}),0;if(e.disabled&&!e.fieldRequeired&&!e.forceValidation)return i.emit(l,{}),0;if(e.disabled&&!e.fieldRequeired&&e.forceValidation)return i.emit(l,{}),0}else if((((b=f.validationGroup)==null?void 0:b.split(","))||[]).includes(a.validationGroup)||a.validationGroup==null){if(!a.$express)return 0;const l=h.paserExpressExt.parse(a.$express);if(l&&l.length>0){const t={};for(const d of l)if(C.includes(d))t[d]=$(d);else{const N=p(e,d);W(N)?t[d]=x(N):t[d]=N}let r=h.paserExpressExt.evaluate(t,a.$express);Array.isArray(r)&&(r=r.toString()),(Number(r)>0||isNaN(Number(r))||r)&&(r=!0);const o=p(e,e.fullKey),s=`setRules_${e.uuid}_${e.fullKey}`;if(e.fieldRequeired&&e.forceValidation&&!e.disabled&&r)return m(o)||i.emit(s,{}),i.emit(s,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1;if(e.fieldRequeired&&e.forceValidation&&!e.disabled&&!r){const d=a.message??"";return i.emit(s,{required:!0,message:d,trigger:["onBlur","onChange"],validator:()=>d}),1}else{if(e.fieldRequeired&&e.forceValidation&&e.disabled&&r)return m(o)?(i.emit(s,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(s,{}),0);if(e.fieldRequeired&&e.forceValidation&&e.disabled&&!r)return i.emit(s,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1;if(e.fieldRequeired&&!e.forceValidation&&!e.disabled&&r)return m(o)?(i.emit(s,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(s,{}),0);if(e.fieldRequeired&&!e.forceValidation&&!e.disabled&&!r){const d=a.message??"必填项";return i.emit(s,{required:!0,message:d,trigger:["onBlur","onChange"],validator:()=>d}),1}else{if(e.fieldRequeired&&!e.forceValidation&&e.disabled&&r)return i.emit(s,{}),0;if(e.fieldRequeired&&!e.forceValidation&&e.disabled&&!r)return i.emit(s,{}),0;if(!e.fieldRequeired&&e.forceValidation&&!e.disabled&&r)return i.emit(s,{}),0;if(!e.fieldRequeired&&e.forceValidation&&!e.disabled&&!r){const d=a.message??"必填项";return i.emit(s,{required:!0,message:d,trigger:["onBlur","onChange"],validator:()=>d}),1}else{if(!e.fieldRequeired&&e.forceValidation&&e.disabled&&r)return i.emit(s,{}),0;if(!e.fieldRequeired&&e.forceValidation&&e.disabled&&!r){const d=a.message??"必填项";return i.emit(s,{required:!0,message:d,trigger:["onBlur","onChange"],validator:()=>d}),1}else{if(!e.fieldRequeired&&!e.forceValidation&&!e.disabled&&r)return i.emit(s,{}),0;if(!e.fieldRequeired&&!e.forceValidation&&!e.disabled&&!r){const d=a.message??"必填项";return i.emit(s,{required:!0,message:d,trigger:["onBlur","onChange"],validator:()=>d}),1}else{if(!e.fieldRequeired&&!e.forceValidation&&e.disabled&&r)return i.emit(s,{}),0;if(!e.fieldRequeired&&!e.forceValidation&&e.disabled&&!r)return i.emit(s,{}),0}}}}}}else return 0}return 0},P=(e,a,f)=>{var l;const{filterProcess$vars:C,WatchProcessConst:$}=E(),{getFormValue:p,getFormData:R}=G(),b=B.getCurrentFormId;B.getRuningPlainsCfg(b);let u=!1;if(a.$disable){const t=h.paserExpressExt.parse(a.$disable);if(t&&t.length>0){const r={};for(const s of t)if(C.includes(s))r[s]=$(s);else{const d=p(e,s);W(d)?r[s]=x(d):r[s]=d}let o=h.paserExpressExt.evaluate(r,a.$disable);Array.isArray(o)&&(o=o.toString()),Number(o)>0||isNaN(Number(o))?u=!0:u=!!o}else{let r=a.$disable;Number(r)>0||isNaN(Number(r))?u=!0:u=!!r}}if(u){const t=`setRules_${e.uuid}_${e.fullKey}`,r=p(e,e.fullKey);if(!e.disabled&&e.fieldRequeired&&e.forceValidation)return m(r)?(i.emit(t,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(t,{}),0);if(!e.disabled&&e.fieldRequeired&&!e.forceValidation)return m(r)?(i.emit(t,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(t,{}),0);if(!e.disabled&&!e.fieldRequeired&&e.forceValidation)return i.emit(t,{}),0;if(!e.disabled&&!e.fieldRequeired&&!e.forceValidation)return i.emit(t,{}),0;if(e.disabled&&e.fieldRequeired&&e.forceValidation)return m(r)?(i.emit(t,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(t,{}),0);if(e.disabled&&e.fieldRequeired&&!e.forceValidation)return i.emit(t,{}),0;if(e.disabled&&!e.fieldRequeired&&!e.forceValidation)return i.emit(t,{}),0;if(e.disabled&&!e.fieldRequeired&&e.forceValidation)return i.emit(t,{}),0}else if((((l=f.validationGroup)==null?void 0:l.split(","))||[]).includes(a.validationGroup)||a.validationGroup==null){if(e.disabled&&e.forceValidation||!e.disabled){if(!a.validator)return 0;const r=B.getCurrentFormId,o=B.getRuningValidators(r);if(!o[a.validator])return 0;const s=p(e,e.fullKey),d=R(),A={...I.cloneDeep(e),$$$binding:{row:{data:d}}};let V=o[a.validator](s,A,d);const q=`setRules_${e.uuid}_${e.fullKey}`;let v=!0;typeof V=="boolean"?(v=V,V="必填项"):v=!1;const y=p(e,e.fullKey);if(e.fieldRequeired&&e.forceValidation&&!e.disabled&&v)return m(y)?(i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"]}),1):(i.emit(q,{}),0);if(e.fieldRequeired&&e.forceValidation&&!e.disabled&&!v)return i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"],validator:()=>V}),1;if(e.fieldRequeired&&e.forceValidation&&e.disabled&&v)return m(y)?(i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"]}),1):(i.emit(q,{}),0);if(e.fieldRequeired&&e.forceValidation&&e.disabled&&!v)return i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"],validator:()=>V}),1;if(e.fieldRequeired&&!e.forceValidation&&!e.disabled&&v)return m(y)?(i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"]}),1):(i.emit(q,{}),0);if(e.fieldRequeired&&!e.forceValidation&&!e.disabled&&!v)return i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"],validator:()=>V}),1;if(e.fieldRequeired&&!e.forceValidation&&e.disabled&&v)return i.emit(q,{}),0;if(e.fieldRequeired&&!e.forceValidation&&e.disabled&&!v)return i.emit(q,{}),0;if(!e.fieldRequeired&&e.forceValidation&&!e.disabled&&v)return i.emit(q,{}),0;if(!e.fieldRequeired&&e.forceValidation&&!e.disabled&&!v)return i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"],validator:()=>V}),1;if(!e.fieldRequeired&&e.forceValidation&&e.disabled&&v)return i.emit(q,{}),0;if(!e.fieldRequeired&&e.forceValidation&&e.disabled&&!v)return i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"],validator:()=>V}),1;if(!e.fieldRequeired&&!e.forceValidation&&!e.disabled&&v)return i.emit(q,{}),0;if(!e.fieldRequeired&&!e.forceValidation&&!e.disabled&&!v)return i.emit(q,{required:!0,message:V,trigger:["onBlur","onChange"],validator:()=>V}),1;if(!e.fieldRequeired&&!e.forceValidation&&e.disabled&&v)return i.emit(q,{}),0;if(!e.fieldRequeired&&!e.forceValidation&&e.disabled&&!v)return i.emit(q,{}),0}return 0}return 0},n=(e,a)=>{const f=`setRules_${a.uuid}_${a.fullKey}`;return e?(i.emit(f,{required:!0,message:"必填项",trigger:["onBlur","onChange"]}),1):(i.emit(f,{}),0)};return{executeValidate:F,executeRequiredValidate:K}};export{D as u};
