import{w as x,d as O,a6 as z,m as V,o as j,a7 as F,a8 as $,a9 as H,aa as B,x as M,L as N,M as T,Q as w,a as q,l as U,v as k,u as m,h as G,b as A,e as W,r as Y,G as Z,g as J,J as Q,q as X}from"./main-BnXXyOo5.js";import{u as ee}from"./formWatch-KqHO0hI-.js";import"./useFormEnv-VwQXjqJl.js";import"./encodeext-DBC3bVZy.js";import"./useInitFieldState-EKN-2KHT.js";var ne=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCommentChange","onCompositionEnd","onCompositionStart","onCompositionUpdate","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onInput","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],te=function(e){return ne.map(function(o){return o.toLowerCase()}).indexOf(e.toLowerCase())!==-1},oe=function(e,o,t){Object.keys(o).filter(te).forEach(function(a){var n=o[a];typeof n=="function"&&(a==="onInit"?n(e,t):t.on(a.substring(2),function(l){return n(l,t)}))})},ae=function(e,o,t,a){var n=e.modelEvents?e.modelEvents:null,l=Array.isArray(n)?n.join(" "):n;x(a,function(c,d){t&&typeof c=="string"&&c!==d&&c!==t.getContent({format:e.outputFormat})&&t.setContent(c)}),t.on(l||"change input undo redo",function(){o.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},ie=function(e,o,t,a,n,l){a.setContent(l()),t.attrs["onUpdate:modelValue"]&&ae(o,t,a,n),oe(e,t.attrs,a)},P=0,K=function(e){var o=Date.now(),t=Math.floor(Math.random()*1e9);return P++,e+"_"+t+P+String(o)},re=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},I=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},le=function(e,o){return I(e).concat(I(o))},ue=function(e){return e==null},L=function(){return{listeners:[],scriptId:K("tiny-script"),scriptLoaded:!1}},de=function(){var e=L(),o=function(n,l,c,d){var r=l.createElement("script");r.referrerPolicy="origin",r.type="application/javascript",r.id=n,r.src=c;var f=function(){r.removeEventListener("load",f),d()};r.addEventListener("load",f),l.head&&l.head.appendChild(r)},t=function(n,l,c){e.scriptLoaded?c():(e.listeners.push(c),n.getElementById(e.scriptId)||o(e.scriptId,n,l,function(){e.listeners.forEach(function(d){return d()}),e.scriptLoaded=!0}))},a=function(){e=L()};return{load:t,reinitialize:a}},se=de(),ce=function(){return typeof window<"u"?window:global},C=function(){var e=ce();return e&&e.tinymce?e.tinymce:null},fe={apiKey:String,licenseKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},b=function(){return b=Object.assign||function(e){for(var o,t=1,a=arguments.length;t<a;t++){o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},b.apply(this,arguments)},me=function(e,o,t,a){return e(a||"div",{id:o,ref:t})},ve=function(e,o,t){return e("textarea",{id:o,visibility:"hidden",ref:t})},D={selector:void 0,target:void 0},ge=O({props:fe,setup:function(e,o){var t=e.init?b(b({},e.init),D):b({},D),a=z(e),n=a.disabled,l=a.modelValue,c=a.tagName,d=V(null),r=null,f=e.id||K("tiny-vue"),_=e.init&&e.init.inline||e.inline,E=!!o.attrs["onUpdate:modelValue"],i=!0,v=e.initialValue?e.initialValue:"",g="",y=function(u){return E?function(){return l!=null&&l.value?l.value:""}:function(){return u?v:g}},p=function(){var u=y(i),s=b(b({},t),{readonly:e.disabled,target:d.value,plugins:le(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:_,license_key:e.licenseKey,setup:function(S){r=S,S.on("init",function(R){return ie(R,e,o,S,l,u)}),typeof t.setup=="function"&&t.setup(S)}});re(d.value)&&(d.value.style.visibility=""),C().init(s),i=!1};x(n,function(u){var s;r!==null&&(typeof((s=r.mode)===null||s===void 0?void 0:s.set)=="function"?r.mode.set(u?"readonly":"design"):r.setMode(u?"readonly":"design"))}),x(c,function(u){var s;E||(g=r.getContent()),(s=C())===null||s===void 0||s.remove(r),M(function(){return p()})}),j(function(){if(C()!==null)p();else if(d.value&&d.value.ownerDocument){var u=e.cloudChannel?e.cloudChannel:"7",s=e.apiKey?e.apiKey:"no-api-key",S=ue(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(s,"/tinymce/").concat(u,"/tinymce.min.js"):e.tinymceScriptSrc;se.load(d.value.ownerDocument,S,p)}}),F(function(){C()!==null&&C().remove(r)}),_||($(function(){i||p()}),H(function(){var u;E||(g=r.getContent()),(u=C())===null||u===void 0||u.remove(r)}));var h=function(u){var s;g=r.getContent(),(s=C())===null||s===void 0||s.remove(r),t=b(b(b({},t),u),D),M(function(){return p()})};return o.expose({rerender:h,getEditor:function(){return r}}),function(){return _?me(B,f,d,e.tagName):ve(B,f,d)}}});const _e=O({__name:"YZHtmleditorarea",props:N({cfg:{},formRow:{}},{modelValue:{type:String},modelModifiers:{}}),emits:N(["update:field"],["update:modelValue"]),setup(e,{emit:o}){const t=T(e,"modelValue"),a=e,n=V(a.cfg),c=V({promotion:!1,font_size_formats:"10px 12px 14px 16px 18px 20px 22px",language:"zh_CN",language_url:"/tinymce/js/tinymce/langs/zh_CN.js",toolbar_mode:"sliding",plugins:"link image table charmap ",toolbar:" undo redo bold italic link bullist numlist indent outdent image blockquote table backcolor forecolor fontsize underline removeformat charmap   ",tinycomments_mode:"embedded",tinycomments_author:"Author name",mergetags_list:[{value:"First.Name",title:"First Name"},{value:"Email",title:"Email"}],convert_urls:!1,images_upload_handler:i=>new Promise((v,g)=>{const y=new FormData;y.append("fileToUpload",i.blob(),i.filename()),Q(X.uploadAttachment.url,y).then(({data:p})=>{p&&p.length>0?p.forEach(h=>{let u=`${window.webConfig.host}bpm/attachment/file/${h.fileId}?access_token=ZHYSoftToken`;v(u)}):g("上传错误！")}).catch(()=>{g("上传错误！")})}),height:100,min_height:a.cfg.minHeight,max_height:a.cfg.maxHeight,content_style:"p{margin-block-start: 2px; margin-block-end: 2px;}body {min-height: auto;}"}),{WatchChageExpress:d,WatchSelfExpress:r}=ee();j(()=>{M(()=>{E(),r(n.value,a.formRow,i=>{t.value=i},i=>{n.value.hidden=i,f("update:field",n.value)},i=>{n.value.disabled=i,f("update:field",n.value)},i=>{n.value.hidden=i,f("update:field",n.value)})})}),x(()=>t.value,(i,v)=>{d(n.value,i,a.formRow)});const f=o,_=V(""),E=()=>{const i=n.value,v=`setDisabled_${i.uuid}_${i.fullKey}`,g=`setHidden_${i.uuid}_${i.fullKey}`,y=`setRules_${i.uuid}_${i.fullKey}`,p=`setClose_${i.uuid}`;w.on(v,h=>{n.value.disabled=h,f("update:field",n.value)}),w.on(p,h=>{_.value=h}),w.on(g,h=>{n.value.hidden=h,f("update:field",n.value)}),w.on(y,h=>{n.value.rules=[h],f("update:field",n.value)})};return(i,v)=>{const g=Y("van-field");return J(),q("div",{class:Z(m(_))},[U(G("div",null,[U(A(g,{readonly:"",name:m(n).bindModel,label:m(n).fieldLabel,modelValue:t.value,"onUpdate:modelValue":v[1]||(v[1]=y=>t.value=y),placeholder:m(n).placeholder,required:m(n).required,rules:m(n).rules,disabled:m(n).disabled,clickable:"","label-align":"top"},{input:W(()=>[A(m(ge),{class:"full-editor",modelValue:t.value,"onUpdate:modelValue":v[0]||(v[0]=y=>t.value=y),"api-key":"no-api-key",init:m(c),disabled:m(n).disabled},null,8,["modelValue","init","disabled"])]),_:1},8,["name","label","modelValue","placeholder","required","rules","disabled"]),[[k,!m(n).hidden]])],512),[[k,!m(n).hidden]])],2)}}});export{_e as default};
