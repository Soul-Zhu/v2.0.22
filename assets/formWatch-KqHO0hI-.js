import{W as q,c as j,ai as M,ah as W,ar as C,Z as R,Q as A,I as K}from"./main-BnXXyOo5.js";import{u as D}from"./useFormEnv-VwQXjqJl.js";import{u as z}from"./encodeext-DBC3bVZy.js";import{u as G}from"./useInitFieldState-EKN-2KHT.js";const Q=q(),J=j(()=>Q.getCurrentFormId),N={$precision:function(e){const t=String(e),r=t.indexOf(".");return r===-1?0:t.length-r-1},$toNumber:function(e){if(isNaN(e))return e;e=""+e,e=parseFloat(e);let r=e.toExponential().match(/\d(?:\.(\d*))?e([+-]\d+)/);return e.toFixed(Math.max(0,(r[1]||"").length-r[2]))},addOp:function(e,t){const r=Math.max(this.$precision(e),this.$precision(t)),o=Math.pow(10,r),l=(Math.round(e*o)+Math.round(t*o))/o;return this.$toNumber(l)},subOp:function(e,t){return this.$toNumber(this.addOp(e,-t))},multOp:function(e,t){const r=this.$precision(e)+this.$precision(t),o=Math.pow(10,r),l=Math.round(e*o)*Math.round(t*o)/(o*o);return this.$toNumber(l)},divOp:function(e,t){let r=this.$precision(e)+this.$precision(t),o;if(t==0)return NaN;let l=Math.pow(10,Math.max(r));return o=e*l/(t*l),this.$toNumber(o)},minusOp:function(e){return-e},modOp:function(e,t){return e%t},greaterThanOp:function(e,t){return e>t},lesserThanOp:function(e,t){return e<t},greaterEquOp:function(e,t){return e>=t},lesserEquOp:function(e,t){return e<=t},notEquOp:function(e,t){return e!=t},andOp:function(e,t){return e&&t},orOp:function(e,t){return e||t},notOp:function(e){return!e},equOp:function(e,t){return e==t},ifFn:function(e,t,r){return e?t:r},minFn:function(e){return e.length==0&&e.push(0),e.forEach((t,r)=>{W(t)&&(e[r]=M(t))}),Math.min.apply(void 0,e)},maxFn:function(e){return e.length==0&&e.push(0),e.forEach((t,r)=>{W(t)&&(e[r]=M(t))}),Math.max.apply(void 0,e)},sumFn:function(e){let t=0;for(var r=0;r<e.length;r++)t=this.addOp(t,Number(e[r]));return t},avgFn:function(e){let t=0;for(var r=0;r<e.length;r++)t=this.addOp(t,Number(e[r]));return e.length?this.divOp(t,e.length):0}},c={ItemType_None:0,ItemType_Value:1,ItemType_Operator:2,ItemType_Function:3,PRI_OPENBRACKET:-1,PRI_LOWEST:0,PRI_BELOWADD:1,PRI_ADD:2,PRI_MULT:3,PRI_EXP:4,PRI_UNARY:5,PRI_FCT:6},V=[{fn:N.addOp,pri:c.PRI_ADD,symbol:"+",unary:!1},{fn:N.subOp,pri:c.PRI_ADD,symbol:"-",unary:!1},{fn:N.multOp,pri:c.PRI_MULT,symbol:"*",unary:!1},{fn:N.divOp,pri:c.PRI_MULT,symbol:"/",unary:!1},{fn:Math.pow,pri:c.PRI_EXP,symbol:"^",unary:!1},{fn:N.minusOp,pri:c.PRI_UNARY,symbol:"-",unary:!0},{fn:N.modOp,pri:c.PRI_MULT,symbol:"%",unary:!1},{fn:N.greaterEquOp,pri:c.PRI_BELOWADD,symbol:">=",unary:!1},{fn:N.lesserEquOp,pri:c.PRI_BELOWADD,symbol:"<=",unary:!1},{fn:N.greaterThanOp,pri:c.PRI_BELOWADD,symbol:">",unary:!1},{fn:N.lesserThanOp,pri:c.PRI_BELOWADD,symbol:"<",unary:!1},{fn:N.notEquOp,pri:c.PRI_BELOWADD,symbol:"!=",unary:!1},{fn:N.andOp,pri:c.PRI_LOWEST,symbol:"&&",unary:!1},{fn:N.orOp,pri:c.PRI_LOWEST,symbol:"||",unary:!1},{fn:N.notOp,pri:c.PRI_MULT,symbol:"!",unary:!0},{fn:N.equOp,pri:c.PRI_BELOWADD,symbol:"==",unary:!1}],Y={E:Math.E,PI:Math.PI},B={sin:{fn:Math.sin,nbArgs:1,symbol:"sin",rpt:!1,isSysFunc:!0},asin:{fn:Math.asin,nbArgs:1,symbol:"asin",rpt:!1,isSysFunc:!0},cos:{fn:Math.cos,nbArgs:1,symbol:"cos",rpt:!1,isSysFunc:!0},acos:{fn:Math.acos,nbArgs:1,symbol:"acos",rpt:!1,isSysFunc:!0},tan:{fn:Math.tan,nbArgs:1,symbol:"tan",rpt:!1,isSysFunc:!0},atan:{fn:Math.atan,nbArgs:1,symbol:"atan",rpt:!1,isSysFunc:!0},atan2:{fn:Math.atan2,nbArgs:1,symbol:"atan2",rpt:!1,isSysFunc:!0},sqrt:{fn:Math.sqrt,nbArgs:1,symbol:"sqrt",rpt:!1,isSysFunc:!0},abs:{fn:Math.abs,nbArgs:1,symbol:"abs",rpt:!1,isSysFunc:!0},ceil:{fn:Math.ceil,nbArgs:1,symbol:"ceil",rpt:!1,isSysFunc:!0},floor:{fn:Math.floor,nbArgs:1,symbol:"floor",rpt:!1,isSysFunc:!0},log:{fn:Math.log,nbArgs:1,symbol:"log",rpt:!1,isSysFunc:!0},pow:{fn:Math.pow,nbArgs:2,symbol:"pow",rpt:!1,isSysFunc:!0},round:{fn:Math.round,nbArgs:1,symbol:"round",rpt:!1,isSysFunc:!0},exp:{fn:Math.exp,nbArgs:1,symbol:"exp",rpt:!1,isSysFunc:!0},if:{fn:N.ifFn,nbArgs:3,symbol:"if",rpt:!1,isSysFunc:!0},min:{fn:N.minFn,nbArgs:1,symbol:"min",rpt:!0,isSysFunc:!0},max:{fn:N.maxFn,nbArgs:1,symbol:"max",rpt:!0,isSysFunc:!0},sum:{fn:N.sumFn,nbArgs:1,symbol:"sum",rpt:!0,isSysFunc:!0},avg:{fn:N.avgFn,nbArgs:1,symbol:"avg",rpt:!0,isSysFunc:!0}},w={curItemTypeStack:[],itemStack:[],opStack:[],vars:[],exp:"",FirstCharStr:"",lastWord:"",curWord:"",nbPops:0,popPtr:0,isUsed:!1,allConstants:!1,parse:function(e){if(this.combined(),e=this.removeSpace(e),!e)return[];let t=e.length,r=0,o="";this.curItemTypeStack=[],this.itemStack=[],this.opStack=[],this.vars=[],this.exp=e,this.pushCurItemType();for(let l=0;l<t;l++){const p=e.charAt(l);if(r===0){if(p=="'"||p=='"'){r=p,o+=p;continue}}else if(p==r)r=0;else{o+=p;continue}let h=this.areNextCharsOpString(e,l);h?(l+=h.symbol.length-1,this.onOp(l,o,h),o=""):p==","?(this.onArgSeparator(l,o),o=""):p=="("?(this.onOpenBracket(l,o),o=""):p==")"?(this.onCloseBracket(l,o),o=""):o+=p}return this.onExpEnd(t-1,o),this.vars??[]},evaluate:function(e,t){t&&this.parse(t);const r=this.itemStack;if(r.length==1&&!r[0].args)return r[0].isVar?e[r[0].val]:r[0].val;let o;for(var l=0;l<r.length;l++){let h=r[l];if(o&&o.itm==h)if(o.i<o.len){l=o.start-1;continue}else o=null;if(h.beginrpt){o={start:l+1,len:0,i:0,itm:h.beginrpt};for(var p=0;p<h.vars.length;p++)if(h.vars[p]in e){let i=e[h.vars[p]];i=i instanceof Array?i:[i],o.len=Math.max(o.len,i.length)}continue}if((o||{len:1}).len!=0){let T=[];for(var p=0;p<h.args.length;p++){let g=h.args[p],u=g.isVar?e[g.val]:g.val;o&&(u=L(u)?u:[u],u=u.length>=o.len?u[o.i]:u[0]),h.eval.rpt&&(u=U(u)?u:[],u=L(u)?u:[u]),T.push(u)}let i=h.eval.fn.apply(N,T),m=h.ParentArg;o&&m.item==o.itm?(m.val=o.i==0?[]:m.val,m.val.push(i),o.i++):m.val=i}else h.ParentArg.val=[]}return r[r.length-1].ParentArg.val},combined(){Object.keys(B).forEach(t=>{B[t].isSysFunc=!0});const e=Q.getRuningFunctions(J.value)??{};Object.keys(e).forEach(t=>{B[t]||(B[t]={fn:e[t],nbArgs:-1,symbol:t,rpt:!1})})},variables:function(){return this.vars},removeSpace:function(e){if(!e)return"";let t=e.length,r=[],o=!1;for(let l=0;l<t;l++){let p=e.charAt(l);(p=="'"||p=='"')&&(o=!o),(p!=" "&&p!="\r"&&p!=`
`||o)&&r.push(p)}return r.join("")},areNextCharsOpString:function(e,t){if(!this.FirstCharStr){let p=[];for(var r=0;r<V.length;r++)p.push(V[r].symbol.charAt(0));this.FirstCharStr=p.join("")}let o=e.charAt(t);if(this.FirstCharStr.indexOf(o)==-1)return!1;for(var r=0;r<V.length;r++){let h=V[r],T=h.symbol,i=h.symbolLength=h.symbolLength||T.length,m=h.firstChar=h.firstChar||T.charAt(0);if(o!=m)continue;let d=!0;for(var l=1;l<i;l++)if(T.charAt(l)!=e.charAt(t+l)){d=!1;break}if(d)return h}return!1},onOp:function(e,t,r){if(!this.parseWord(e,t))return;const o=this.opStack;this.setArgValueFlag(!0),this.setCurItemType(c.ItemType_Operator);let l=this.getPrevItemType(),p=l==c.ItemType_None||l==c.ItemType_Operator;if(r.unary!=p){let i=r.symbol;for(var h=0;h<o.length;h++){let m=o[h];if(m.symbol==i&&m.unary==p){r=m;break}}r.unary!=p&&console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr001')",this.exp,r.symbol)}if(e+r.symbol.length>this.exp.length&&console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr001'), this.exp, op.symbol);",this.exp,r.symbol),o.length>0){let i=o[o.length-1].pri,m=0;for(i!=c.PRI_OPENBRACKET&&(m=r.pri),m==i&&o[o.length-1].itemType==c.ItemType_Operator&&o[o.length-1].eval.unary&&(m=i+1);m<=i;){let d=o.pop();if(this.addAndValidateToExprStack(d),this.opStack.length==0||(i=o[o.length-1].pri,i==c.PRI_OPENBRACKET))break}}let T={nbArgs:p?1:2,pri:r.pri,endWithABlock:!1,eval:r,itemType:c.ItemType_Operator};o.push(T)},onOpenBracket:function(e,t){if(!this.parseWord(e,t))return;this.setArgValueFlag(!1);let r={pri:c.PRI_OPENBRACKET,endWithABlock:!1,itemType:c.ItemType_None};this.opStack.push(r),this.getCurItemType()==c.ItemType_Function&&this.itemStack.push({isUsed:!0,isABlock:!0}),this.pushCurItemType()},onCloseBracket:function(e,t){this.onCloseArgSeparator(e,t,!0)},onArgSeparator:function(e,t){this.onCloseArgSeparator(e,t,!1)},onCloseArgSeparator:function(e,t,r){if(!this.parseWord(e,t))return;this.getCurItemType()==c.ItemType_Operator&&console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr002'), this.exp)",this.exp),this.curItemTypeStack.pop();let o=this.getNextChar(e);r||(this.pushCurItemType(),o==")"&&console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr003'), this.exp);",this.exp));let l,p=0;const h=this.opStack;do if(h.length==0&&(r?console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr004'), this.exp);",this.exp):console.log(" ZHYSoft.Error.raise(RS.$('Form_Express_SynErr003'), this.exp);",this.exp)),l=h[h.length-1].pri,l!=c.PRI_OPENBRACKET){p++;let i=h.pop();this.addAndValidateToExprStack(i)}while(l!=c.PRI_OPENBRACKET);let T=this.incArgCountIfArgValue(h);r&&(h.pop(),this.getCurItemType()!=c.ItemType_Function&&this.setCurItemType(c.ItemType_Value)),p==0&&!r&&!T&&console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr003')",this.exp),this.setArgValueFlag(r&&(o==")"||o==",")?T:!1)},onExpEnd:function(e,t){this.parseWord(e,t);let r=this.opStack,o=this.itemStack;r.length;for(var l=r.length-1;l>=0;l--){let i=r[l];i.pri==c.PRI_OPENBRACKET&&console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr005'), this.exp);",this.exp),this.addAndValidateToExprStack(i)}let p=o.length;for(var l=p-1;l>=0;l--){let m=o[l];(m.isABlock||m.isEvaluated&&l!=p-1)&&o.splice(l,1)}p=o.length;for(var l=0;l<p;l++){let m=o[l];if(m.eval&&m.eval.rpt){let d,g=[];for(d=l-1;d>=0;d--){let u=o[d];if(!this.isParent(m,u))break;let v=u.args;u.eval.rpt&&console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr006'), this.exp, itm1.eval.symbol);",this.exp,u.eval.symbol);for(var h=0;h<v.length;h++){let I=v[h];I.isVar&&g.push(I.val)}}o.splice(d+1,0,{beginrpt:m,vars:g}),p++,l++}}let T=o[o.length-1];T.ParentArg=T.val||{}},getNextChar:function(e){return this.exp.charAt(e+1)||""},isParent:function(e,t){for(;t&&t.ParentArg;)if(t=t.ParentArg.item,t==e)return!0;return!1},setArgValueFlag:function(e){if(this.opStack.length>0){let t=this.opStack.length-1;this.opStack[t].pri==c.PRI_OPENBRACKET&&t--,t>=0&&(this.opStack[t].argValue=e)}},pushCurItemType:function(){this.curItemTypeStack.push({current:c.ItemType_None,previous:c.ItemType_None})},setCurItemType:function(e){let t=this.curItemTypeStack,r=t[t.length-1];r.previous=r.current,r.current=e},getPrevItemType:function(){let e=this.curItemTypeStack;return e[e.length-1].previous},getCurItemType:function(){let e=this.curItemTypeStack;return e[e.length-1].current},addAndValidateToExprStack:function(e){e.itemType==c.ItemType_Function&&e.eval.nbArgs!=-1&&e.eval.nbArgs!=e.nbArgs&&console.log(" ZHYSoft.Error.raise(RS.$('Form_Express_SynErr007'), this.exp, opi.eval.symbol, opi.eval.nbArgs);",this.exp,e.eval.symbol,e.eval.nbArgs);let t={eval:e.eval,nbArgs:e.nbArgs,args:[],endWithABlock:e.endWithABlock};this.itemStack.push(t);try{this.evaluateValidate()}catch{console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr008'), e.message);")}},evaluateValidate:function(){this.allConstants=!0,this.nbPops=0;let e=this.itemStack;if(e.length==0)return 0;let t=this.evaluateValidateItem(e.length-1);e[e.length-1].isUsed=!0;for(var r=0;r<e.length;r++)e[r].isUsed=!1;return t},evaluateValidateItem:function(e){let t=this.itemStack,r=t[e];if(r.isUsed&&console.log(" ZHYSoft.Error.raise('Internal Error:001');"),r.isEvaluated)return r.isUsed=!0,r.val;this.popPtr=e-1;for(let l=r.nbArgs-1;l>=0;l--){let p=r.args[l]=r.args[l]||{item:r},h=this.popValidate(p);p.isVar=h.isVar||!1,p.val=U(h.val)?h.val:null}let o={val:0};return r.endWithABlock&&(t[this.popPtr].isABlock?this.popPtr--:console.log("ZHYSoft.Error.raise('Internal Error:002'); ")),o},popValidate:function(e){this.nbPops++,this.nbPops<0&&console.log(" ZHYSoft.Error.raise('Internal Error:003');");let t={},r=this.itemStack[this.popPtr];return r.isABlock&&console.log("ZHYSoft.Error.raise('Internal Error:004');"),r.isUsed&&console.log("ZHYSoft.Error.raise('Internal Error:005');"),r.ParentArg=e,r.isEvaluated?(t.isVar=r.isVar,t.val=r.val,r.isUsed=!0,this.popPtr--):(t=this.evaluateValidateItem(this.popPtr),this.isUsed=!0),t},parseWord:function(e,t){let r=!0;if(!t)return!0;const o=this.getCurItemType();if(o!=c.ItemType_Operator&&o!=c.ItemType_None&&console.log("  ZHYSoft.Error.raise(RS.$('Form_Express_SynErr009'), this.exp);",this.exp),this.exp.charAt(e)=="("){let l=B[t];l?(this.setArgValueFlag(!0),this.setCurItemType(c.ItemType_Function),this.opStack.push({pri:c.PRI_FCT,endWithABlock:!0,nbArgs:0,eval:l,argValue:!1,itemType:c.ItemType_Function})):console.log("ZHYSoft.Error.raise(RS.$('Form_Express_SynErr010'), this.exp, w);",this.exp,t)}else if(this.isNumber(t))this.setCurItemType(c.ItemType_Value),this.itemStack.push({isEvaluated:!0,val:parseFloat(t)}),this.setArgValueFlag(!0);else if(this.isString(t))this.setCurItemType(c.ItemType_Value),t=t.substring(1,t.length-1),this.itemStack.push({isEvaluated:!0,val:t}),this.setArgValueFlag(!0);else{let l={isEvaluated:!0,isVar:!1,val:""};t in Y?l.val=Y[t]:(l.isVar=!0,l.val=t,t in this.vars||this.vars.push(t)),this.setCurItemType(c.ItemType_Value),this.itemStack.push(l),this.setArgValueFlag(!0)}return this.lastWord=t,this.curWord="",r},incArgCountIfArgValue:function(e){if(e.length>0){let t=e.length-1;if(e[t].pri==c.PRI_OPENBRACKET&&t--,t>=0&&e[t].argValue)return e[t].itemType==c.ItemType_Function&&e[t].nbArgs++,!0}return!1},isNumber:function(e){if(H(e))return!0;if(!Z(e))return!1;let t=e.length,r=!1;for(let o=0;o<t;o++){if(!r&&o>=15)return!1;let l=e.charCodeAt(o);if(l==46){if(r)return!1;r=!0}else if(l<48||l>57)return!1}return!(t==0||!r&&t!=1&&e.charCodeAt(0)==48)},isString:function(e){if(!Z(e))return!1;e=ee(e);let t=e.length;if(t<2)return!1;let r=e.charAt(0),o=e.charAt(t-1);return r==o&&(r=="'"||r=='"')}},X=Number.isFinite||function(e){return typeof e=="number"&&X(e)},Z=e=>typeof e=="string",H=e=>typeof e=="number"&&X(e),U=e=>typeof e<"u",L=e=>Array.isArray(e),ee=e=>{const t=new RegExp(`^[	
\v\f\r   ᠎   
            \u2028\u2029  　]
    +|[	
\v\f\r   ᠎    
           \u2028\u2029  　]+$`,"g");return e&&(e=e.replace(t,"")),e||""},b={paserExpressExt:w},k=q(),{initDisabledFieldState:F}=G(),{getFormEnv:te}=D(),oe=()=>{const e=["$isInform","$isPost","$isProcess","$isRead","$activityName","$activityId"],t=(i,m,d,g,u,v)=>{const{getFormValue:I}=K(),{$hidden:_,$express:x,$columnHidden:$,$disable:P}=i;if(x){const S=i.bindModel,s=m[S],{isEmpty:n}=z(),a=te();if(S&&S in m&&(a!==R.POST||!n(s)))console.log("不做计算");else if(i.isChild){const f=b.paserExpressExt.parse(i.$express);if(f&&f.length>0){const y={};for(const O of f)e.includes(O)?y[O]=l(O):y[O]=I(i,O);let E=b.paserExpressExt.evaluate(y,i.$express);Array.isArray(E)&&(E=E.toString()),d&&d(E)}else d&&d(x)}else{const f=b.paserExpressExt.parse(i.$express);if(f&&f.length>0){const y={};for(const O of f)e.includes(O)?y[O]=l(O):y[O]=I(i,O);let E=b.paserExpressExt.evaluate(y,i.$express);Array.isArray(E)&&(E=E.toString()),d&&d(E)}else{const y=b.paserExpressExt.evaluate({},i.$express);d&&d(y)}}}if(_)if(!i.canRead&&i.fieldModule==="field")g&&g(r(!i.canRead,i));else if(i.isChild){const S=b.paserExpressExt.parse(i.$hidden);if(S&&S.length>0){const s={};for(const a of S)e.includes(a)?s[a]=l(a):s[a]=I(i,a);let n=b.paserExpressExt.evaluate(s,i.$hidden);Array.isArray(n)&&(n=n.toString()),Number(n)>0||isNaN(Number(n))?g&&g(!0):g&&g(r(!!n,i))}else{const s=_;Number(s)>0||isNaN(Number(s))?g&&g(!0):g&&g(r(!!s,i))}}else{const S=b.paserExpressExt.parse(i.$hidden);if(S&&S.length>0){const s={};for(const a of S)e.includes(a)?s[a]=l(a):s[a]=I(i,a);let n=b.paserExpressExt.evaluate(s,i.$hidden);Array.isArray(n)&&(n=n.toString()),Number(n)>0||isNaN(Number(n))?g&&g(!0):g&&g(r(!!n,i))}else{const s=_;Number(s)>0||isNaN(Number(s))?g&&g(!0):g&&g(r(!!s,i))}}if($)if(!i.canRead&&i.fieldModule==="field")v&&v(!i.canRead);else if(i.isChild){const S=b.paserExpressExt.parse(i.$columnHidden);if(S&&S.length>0){const s={};for(const a of S)e.includes(a)?s[a]=l(a):s[a]=I(i,a);let n=b.paserExpressExt.evaluate(s,i.$columnHidden);Array.isArray(n)&&(n=n.toString()),Number(n)>0||isNaN(Number(n))?v&&v(!0):v&&v(r(!!n,i))}else{const s=$;Number(s)>0||isNaN(Number(s))?v&&v(!0):v&&v(r(!!s,i))}}else{const S=b.paserExpressExt.parse(i.$columnHidden);if(S&&S.length>0){const s={};for(const a of S)e.includes(a)?s[a]=l(a):s[a]=I(i,a);let n=b.paserExpressExt.evaluate(s,i.$columnHidden);Array.isArray(n)&&(n=n.toString()),Number(n)>0||isNaN(Number(n))?v&&v(!0):v&&v(r(!!n,i))}else{const s=$;Number(s)>0||isNaN(Number(s))?v&&v(!0):v&&v(r(!!s,i))}}if(P)if(!i.canWirte&&i.fieldModule==="field")u&&u(!i.canWirte),F(i,!0);else if(i.isChild){const S=b.paserExpressExt.parse(i.$disable);if(S&&S.length>0){const s={};for(const a of S)e.includes(a)?s[a]=l(a):s[a]=I(i,a);let n=b.paserExpressExt.evaluate(s,i.$disable);if(Array.isArray(n)&&(n=n.toString()),Number(n)>0){const a=setTimeout(()=>{clearTimeout(a)},50);u&&u(!0)}else if(isNaN(Number(n))){const a=setTimeout(()=>{clearTimeout(a)},50);u&&u(!0)}else{const a=setTimeout(()=>{clearTimeout(a)},50);u&&u(!!n)}}else{const s=P;if(Number(s)>0){const n=setTimeout(()=>{clearTimeout(n)},50);u&&u(!0)}else if(isNaN(Number(s))){const n=setTimeout(()=>{clearTimeout(n)},50);u&&u(!0)}else{const n=setTimeout(()=>{clearTimeout(n)},50);u&&u(!!s)}}}else{const S=b.paserExpressExt.parse(i.$disable);if(S&&S.length>0){const s={};for(const a of S)e.includes(a)?s[a]=l(a):s[a]=I(i,a);let n=b.paserExpressExt.evaluate(s,i.$disable);if(Array.isArray(n)&&(n=n.toString()),Number(n)>0){const a=setTimeout(()=>{clearTimeout(a)},50);F(i,!0),u&&u(!0)}else if(isNaN(Number(n))){const a=setTimeout(()=>{clearTimeout(a)},50);F(i,!0),u&&u(!0)}else{const a=setTimeout(()=>{clearTimeout(a)},50);F(i,!!n),u&&u(!!n)}}else{let s=P;if(Number(s)>0){const n=setTimeout(()=>{clearTimeout(n)},50);F(i,!0),u&&u(!0)}else if(isNaN(Number(s))){const n=setTimeout(()=>{clearTimeout(n)},50);F(i,!0),u&&u(!0)}else{const n=setTimeout(()=>{clearTimeout(n)},50);F(i,!!s),u&&u(!!s)}}}},r=(i,m)=>!i&&m.mobileVisibility===!1?!0:i,o=(i,m,d)=>{const g=p(i,"$express"),u=p(i,"$disable"),v=p(i,"$hidden"),I=p(i,"$columnHidden"),{getFormValue:_,setFormValue:x}=K(),$=k.getCurrentFormId,P=`onField_Change_${i.fullKey}_${$}`,S=`onField_Filter_${i.fullKey}_${$}`;if(A.emit(P,{currentCfg:i,currentValue:m,currentRow:d}),A.emit(S,{currentCfg:i,currentValue:m,currentRow:d}),g.length>0)for(const s of g)if(s.isChild){const n=b.paserExpressExt.parse(s.$express);if(n&&n.length>0){const a={};for(const y of n)e.includes(y)?a[y]=l(y):a[y]=_(s,y);let f=b.paserExpressExt.evaluate(a,s.$express);Array.isArray(f)&&(f=f.toString()),x(s,s.fullKey,f)}}else{const n=b.paserExpressExt.parse(s.$express);if(n&&n.length>0){const a={};for(const y of n)e.includes(y)?a[y]=l(y):a[y]=_(s,y);let f=b.paserExpressExt.evaluate(a,s.$express);Array.isArray(f)&&(f=f.toString()),x(s,s.fullKey,f)}}if(u.length>0)for(const s of u){if(!s.canWirte&&s.fieldModule==="field"){const n=`setDisabled_${s.uuid}_${s.fullKey}`;A.emit(n,!0),F(s,!0);continue}if(s.isChild){const n=b.paserExpressExt.parse(s.$disable);if(n&&n.length>0){const a={};for(const E of n)e.includes(E)?a[E]=l(E):a[E]=_(s,E);let f=b.paserExpressExt.evaluate(a,s.$disable);Array.isArray(f)&&(f=f.toString());const y=`setDisabled_${s.uuid}_${s.fullKey}`;Number(f)>0?(F(s,!0),A.emit(y,!0)):isNaN(Number(f))?(F(s,!0),A.emit(y,!0)):(F(s,!!f),A.emit(y,!!f))}}else{const n=b.paserExpressExt.parse(s.$disable);if(n&&n.length>0){const a={};for(const E of n)e.includes(E)?a[E]=l(E):a[E]=_(s,E);let f=b.paserExpressExt.evaluate(a,s.$disable);Array.isArray(f)&&(f=f.toString());const y=`setDisabled_${s.uuid}_${s.fullKey}`;Number(f)>0?(A.emit(y,!0),F(s,!0)):isNaN(Number(f))?(F(s,!0),A.emit(y,!0)):(F(s,!!f),A.emit(y,!!f))}}}if(v.length>0)for(const s of v){if(!s.canRead&&s.fieldModule==="field"){const n=`setHidden_${s.uuid}_${s.fullKey}`;A.emit(n,!0);continue}if(s.isChild){const n=b.paserExpressExt.parse(s.$hidden);if(n&&n.length>0){const a={};for(const E of n)e.includes(E)?a[E]=l(E):a[E]=_(s,E);let f=b.paserExpressExt.evaluate(a,s.$hidden);Array.isArray(f)&&(f=f.toString());const y=`setHidden_${s.uuid}_${s.fullKey}`;Number(f)>0?A.emit(y,!0):isNaN(Number(f))?A.emit(y,!0):A.emit(y,r(!!f,s))}}else{const n=b.paserExpressExt.parse(s.$hidden);if(n&&n.length>0){const a={};for(const E of n)e.includes(E)?a[E]=l(E):a[E]=_(s,E);let f=b.paserExpressExt.evaluate(a,s.$hidden);Array.isArray(f)&&(f=f.toString());const y=`setHidden_${s.uuid}_${s.fullKey}`;Number(f)>0?A.emit(y,!0):isNaN(Number(f))?A.emit(y,!0):A.emit(y,r(!!f,s))}}}if(I.length>0)for(const s of I){if(!s.canRead&&s.fieldModule==="field"){const n=`setColumnHidden_${s.uuid}_${s.fullKey}`;A.emit(n,!0)}if(s.isChild){const n=b.paserExpressExt.parse(s.$columnHidden);if(n&&n.length>0){const a={};for(const E of n)e.includes(E)?a[E]=l(E):a[E]=_(s,E);let f=b.paserExpressExt.evaluate(a,s.$columnHidden);Array.isArray(f)&&(f=f.toString());const y=`setColumnHidden_${s.uuid}_${s.fullKey}`;Number(f)>0?A.emit(y,!0):isNaN(Number(f))?A.emit(y,!0):A.emit(y,r(!!f,s))}}else{const n=b.paserExpressExt.parse(s.$columnHidden);if(n&&n.length>0){const a={};for(const E of n)e.includes(E)?a[E]=l(E):a[E]=_(s,E);let f=b.paserExpressExt.evaluate(a,s.$columnHidden);Array.isArray(f)&&(f=f.toString());const y=`setColumnHidden_${s.uuid}_${s.fullKey}`;Number(f)>0?A.emit(y,!0):isNaN(Number(f))?A.emit(y,!0):A.emit(y,r(!!f,s))}}}},l=i=>{const{getFormEnv:m}=D(),d=m(),g=k.getCurrentFormId,u=k.getRuningPositionDefined(g),v=k.getRuningProcessInfoDefined(g);return u?i===C.$activityId?d===R.POST?u.activityId:d===R.PROCESS?v.activityId:"":i===C.$activityName?d===R.POST?u.activityName:d===R.PROCESS?v.activityName:"":i===C.$isInform?d===R.NOFITY:i===C.$isPost?d===R.POST:i===C.$isProcess?d===R.NOFITY?v?v.taskInstance.stepFinished==!1:"":d===R.PROCESS:i===C.$isRead?d===R.READ||d===R.REQUEST:!1:""},p=(i,m)=>{const d=k.getCurrentFormId,u=k.getRuningPlainsCfg(d).filter($=>$[m]),v=i.fullKey,I=[];for(const $ of u){const P=$[m],S=b.paserExpressExt.parse(P);S&&S.includes(v)&&$.rowId===i.rowId&&(I.find(n=>n.rowId==$.rowId&&n.fullKey==$.fullKey)||I.push($))}const _=[];h(i.rowPId,u,_);const x=[];return T(i.rowId,u,x),_.forEach($=>{const P=$[m],S=b.paserExpressExt.parse(P);S&&S.includes(v)&&(I.find(n=>n.rowId==$.rowId&&n.fullKey==$.fullKey)||I.push($))}),x.forEach($=>{const P=$[m],S=b.paserExpressExt.parse(P);S&&S.includes(v)&&(I.find(n=>n.rowId==$.rowId&&n.fullKey==$.fullKey)||I.push($))}),I},h=(i,m,d)=>{if(i===void 0)return[];const g=m.filter(u=>u.rowId===i);for(const u of g)d.push(u),h(u.rowPId,m,d)},T=(i,m,d)=>{if(i===void 0)return[];const g=m.filter(u=>u.rowPId===i);for(const u of g)d.push(u),T(u.rowId,m,d)};return{WatchSelfExpress:t,WatchChageExpress:o,WatchProcessConst:l,filterProcess$vars:e}};export{b as p,oe as u};
