import{af as c,a2 as d,ag as h,p as n,q as o,ad as u,K as F,J as f}from"./main-BnXXyOo5.js";const p=c("form",{state:()=>({defaultCfg:[],dataSourceId:"",fields:[],positions:[],positionsFill:[],positionDefind:{},header:{},childFormData:{},positionName:"",memberId:"",execueFieldStore:[],removeFieldStore:[],systemFieldStore:{sn:"",initiator:"",dept:"",owern:"",starttime:"",memberId:"",owernpropey:"",initiatorName:"",deptId:"",owernAccount:""},startUser:{},startDepart:{},viewModel:{},formDefined:{},pliansFields:[],haveComputeFields:[],languages:{},processInfoDefind:{},processReadInfoDefind:{},formFunc:{},formVaild:{},changedFields:[],childFormPliansFields:[],VantFormData:{}}),getters:{getVantDefaultCfg:e=>e.defaultCfg,getVantFormData:e=>e.VantFormData,getDataSourceId:e=>e.dataSourceId,getFields:e=>e.fields,getPositions:e=>e.positions,getPositionName:e=>e.positionName,getExeuteFieldStore:e=>e.execueFieldStore,getRemoveFieldStore:e=>e.removeFieldStore,getSystemStore:e=>e.systemFieldStore,getPositionDefined:e=>e.positionDefind,getViewModel:e=>e.viewModel,getOwerProp:e=>e.systemFieldStore.owernpropey,getPlianFields:e=>e.pliansFields,getFormVarsStr:e=>{const t=[],s=e.pliansFields;for(let i in s){const a=s[i];if(a.bindModel&&a.ctype!==d.YZGrid){const l=a.fullKey.replace("$$root.","");t.push(l)}}return t.join("|")},getComputeFieldStore:e=>e.haveComputeFields,getLanguages:e=>e.languages,getHeaders:e=>e.header,getProcessInfoDefind:e=>e.processInfoDefind,getProcessReadInfoDefind:e=>e.processReadInfoDefind,getFormFuncs:e=>e.formFunc??{},getFormVaild:e=>e.formVaild,getChangedFields:e=>e.changedFields,getChildFormPliansFields:e=>e.childFormPliansFields[e.childFormPliansFields.length-1]},actions:{convertFillPosition(){const e=this.$state.positionsFill;return e&&e.length>0?{memberId:e[0].memberId,providerName:e[0].providerName}:{}},async getPrositionDefined(e,t,s){const i=this,{data:a,success:l,errorMessage:r}=await f(o.getProcessDefined.url.toFetchUrl({params1:e}),{draftId:t??-1,owner:s&&Object.keys(s).length>0?s:i.convertFillPosition()});if(!l)throw F(r,"danger"),new Error(r);return this.$state.positionDefind=a,this.$state.positions=a.positions,a.positions&&a.positions.length>0&&(this.$state.positionName=a.positions[0].text),this.setPostView(a.viewModel),a},async getReadinfoDefined(e){const{data:t,success:s,errorMessage:i}=await n(o.getMyprocessedReadinfo.url.toFetchUrl({params1:e}),{});if(!s)throw F(i,"danger"),new Error(i);return this.$state.positionDefind=t,this.setPostView(t.viewModel),t},async getFormDefined(e){const{success:t,data:s,errorMessage:i}=await n(o.getFormDefined.url.toFetchUrl({params1:e}));if(!t)throw new Error(i);return this.$state.dataSourceId=s.property.persistenceSetting.dataSourceId,this.setFormLanguage(s),s},setFormLanguage(e){if(e.property.localizationSetting&&e.property.localizationSetting.enable){const{languages:t}=e.property.localizationSetting;u().setFormLanguage(t)}},async getPostStartUser(e){if(!e)return{};const{data:t}=await n(o.getInitUserInfo.url.toFetchUrl({params1:e}));return t},async getPostStartDeaprt(e){const{data:t}=await n(o.getInitUserDepart.url.toFetchUrl({params1:e}));return t},getViewModelBindType(e){const t=this.$state.viewModel;if(e.indexOf(".")>-1){const s=e.split(".")[0],i=e.split(".")[1],a=t[s];return a.columns[i]?a.columns[i].dataType:h.String}return h.String},setPostView(e){if(e&&e.schema){const t={};Object.keys(e.schema).forEach(s=>{const i=e.schema[s];t[s]={allowAddRecord:i.allowAddRecord,isRepeatTable:i.isRepeatTable,columns:{}},i.columns&&Object.keys(i.columns).forEach(a=>{t[s].columns[a]={dataType:i.columns[a].dataType,readable:i.columns[a].readable,uniqueId:i.columns[a].uniqueId,writeable:i.columns[a].writeable}})}),this.viewModel=t}},setFields(e){this.$state.fields.push(e);let t=this.$state.fields[this.$state.fields.length-1];this.setPliansFields(t);const s=this.resovePlainFields(e);this.$state.childFormPliansFields.push(s)},resovePlainFields(e){if(!e)return[];const t=[];for(const s of e)if(s.ctype===d.YZGrid){t.push(s);continue}else s.fullKey=s.fullKey.replace("$$root.",""),t.push(s);return t},setPliansFields(e){},setHeaderPositioOUId(e){this.$state.header.ouid=e},setHeaderOwerPosition(e){this.$state.header.ownerPosition=e},setHeaderStore(e){this.$state.header=e},setHeaderStoreField(e,t){this.$state.header[e]=t},setChildFormData(e){this.$state.childFormData=e},setPositonName(e){const t=this.$state.positions.find(s=>s.ouid===e);this.$state.positionName="",t&&(this.$state.positionName=t.text)},setMemberId(e){this.$state.memberId=e},setExecuteField(e){this.$state.execueFieldStore.findIndex(s=>s.uniqueId===e.uniqueId)<0&&this.$state.execueFieldStore.push(e)},setRemoveField(e){this.$state.removeFieldStore.findIndex(s=>s===e)<0&&this.$state.removeFieldStore.push(e)},setSystemStore(e,t){this.$state.systemFieldStore[e]=t},setFormDefined(e){this.$state.formDefined=e},getComponentByCtype(e){const t=this.$state.formDefined.components;return t?t[e]:null},getFieldByFullKey(e){const t=this.$state.pliansFields.find(s=>s.fullKey===e);return t||null},getField(e){const s=this.$state.fields[this.$state.fields.length-1].find(i=>i.uniqueId===e);return s||null},cleatLastFiels(){this.$state.fields.pop();let e=this.$state.fields[this.$state.fields.length-1];this.setPliansFields(e),this.cleatChildLastPliansFields()},cleatChildLastPliansFields(){this.$state.childFormPliansFields.pop(),this.pliansFields=this.$state.childFormPliansFields[this.$state.childFormPliansFields.length-1]},setProcessInfoDefined(e){this.$state.processInfoDefind=e},setProcessReadDefind(e){this.$state.processReadInfoDefind=e},addPlinasFields(e){this.$state.pliansFields===void 0&&(this.$state.pliansFields=[]),this.$state.pliansFields.findIndex(s=>s.uuid===e.uuid)<0&&this.$state.pliansFields.push(e)},addChildFormPliansFields(e){this.$state.childFormPliansFields.length-1>=0&&this.$state.childFormPliansFields[this.$state.childFormPliansFields.length-1].push(e)},removePlinasFields(e){const t=this.$state.pliansFields.findIndex(s=>s.uuid===e.uuid);t>-1&&this.$state.pliansFields.splice(t,1)},removeChildFormPliansFields(e){this.$state.childFormPliansFields[this.$state.childFormPliansFields.length-1].splice(e,1)},setFormFuncs(e){this.$state.formFunc=e},setFormVaild(e){this.$state.formVaild=e},setPositionsFill(e){this.$state.positionsFill=[],this.$state.positionsFill.push(e)},clearPositionsFill(){this.$state.positionsFill=[]},setChangedFields(e){this.$state.changedFields=e},clearChangedFields(){this.$state.changedFields=[]},setDefaultCfg(e){this.$state.defaultCfg=e},setFormData(e){this.$state.VantFormData=e},setHeaderDraftId(e){this.$state.header.draftid=e}}});export{p as u};
