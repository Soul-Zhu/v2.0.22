import{d as ae,L as O,W as ne,M as re,m as v,o as se,x as le,w as ie,Q as _,a as q,l as ue,v as de,u as a,h as H,b as W,s as U,e as R,r as Y,G as Z,g as I,n as z,k as ce,t as G,K as b,q as L,p as P,I as me}from"./main-BnXXyOo5.js";import fe from"./YZCHildFormPop-B8QJaJMO.js";import{_ as ve}from"./YZChangeFieldTag.vue_vue_type_style_index_0_lang-CU_sMXjx.js";import{u as pe}from"./formWatch-KqHO0hI-.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useDefaultRow-Bhv6lFSR.js";import"./LoginFactory-C2TRmDIo.js";import"./wecom.prod-DVLinVsr.js";import"./dynamic-import-helper-BheWnx7M.js";import"./useInitFieldState-EKN-2KHT.js";import"./formStore-Byb73AL_.js";import"./useClearnForm-ePekKxJW.js";import"./formEvent.hook-CPQy9-nk.js";import"./heightValidate-C1QXqfrl.js";import"./encodeext-DBC3bVZy.js";import"./useProcessFormData-BB1RW82V.js";import"./useFormEnv-VwQXjqJl.js";const he={class:"child-form-link"},ye=ae({__name:"YZChildform",props:O({cfg:{},formRow:{}},{modelValue:{type:String},modelModifiers:{}}),emits:O(["update:field"],["update:modelValue"]),setup(B,{emit:Q}){const{WatchChageExpress:x,WatchSelfExpress:j}=pe(),p=ne(),{getFormValue:S,setFormValue:E}=me(),m=re(B,"modelValue"),u=B,o=v(u.cfg),M=v(),N=v(""),C=v(),y=v(!1),k=v(),$=v("New"),K=v(),F=v(),J=e=>{const{formServiceDataBind:s,formServiceNewState:n,formServiceReadState:d,formServiceEditState:l}=u.cfg;s||(b("控件没有绑定表单服务","danger"),e(!1)),s&&(m.value?u.cfg.disabled?$.value=d:$.value=l:$.value=n),e(!0)},D=async()=>{J(async e=>{if(e)if(m.value){const s=u.cfg.formService,n=L.getEditFormService.url.toFetchUrl({params1:s.fmid,params2:m.value}),{success:d,errorMessage:l,data:c}=await P(n);if(!d){b(l,"danger");return}const{app:t}=c;if(!t){b("没有找到子表单","danger");return}M.value=t.formId,N.value=t.formName,C.value=t.viewModel,F.value=m.value,K.value=t.appId,k.value=T();const i=`${p.getCurrentFormId}_${t.formId}`;p.setRuningFormId(i),y.value=!0}else{const s=u.cfg.formService;if(!s){b("控件没有绑定表单服务","danger");return}const n=L.getNewFormService.url.toFetchUrl({params1:s.fmid}),{success:d,errorMessage:l,data:c}=await P(n);if(!d){b(l,"danger");return}const{app:t}=c;if(!t){b("没有找到子表单","danger");return}M.value=t.formId,N.value=t.formName,C.value=t.viewModel,K.value=t.appId,k.value=T();const i=`${p.getCurrentFormId}_${t.formId}`;p.setRuningFormId(i),p.setRuningInitaotr(i,t.initiatorAccount),p.setRuningMember(i,t.memberId),p.setRuningOuId(i,t.ouid),p.setRuningOwnerAccount(i,t.ownerAccount),p.setRuningProviderName(i,t.providerName),y.value=!0}})},T=()=>{const s=u.cfg.$bring,n={};if(s){const d=s.mapping;for(const l in d)if(l==="$$root"){const c=d[l];for(const t in c)if(t==="$$root"){const r=c[t];for(const i in r){const w=r[i],h=i,f=S(u.cfg,w);n[h]=f}}else continue}else{const c=d[l];for(const t in c)if(t==="$$root"){const r=c[t];for(const i in r){const w=`${l}.${r[i]}`,h=i;n[h]="";const f=S(u.cfg,w);f&&f.length>0&&(n[h]=f[0])}}else{const r=c[t];n[t]=[];for(const i in r){const w=`${l}.${r[i]}`,h=i;let f=S(u.cfg,w);n[t].length==0?(Array.isArray(f)||(f=[]),f.forEach(V=>{n[t].push({[h]:V})})):f.forEach((V,te)=>{n[t][te][h]=V})}}}}return n};se(()=>{oe(),le(()=>{j(o.value,u.formRow,e=>{m.value=e},e=>{o.value.hidden=e,g("update:field",o.value)},e=>{o.value.disabled=e,g("update:field",o.value)},e=>{o.value.hidden=e,g("update:field",o.value)})})}),ie(()=>m.value,(e,s)=>{x(o.value,e,u.formRow)});const X=()=>{y.value=!1},ee=e=>{if($.value==="Read"){y.value=!1;return}m.value=e.Key;const s=u.cfg.$map;if(s)for(const n in s){const d=s[n];if(n==="Key"){const l=e.Key;F.value=l,E(u.cfg,d,l)}if(n==="SN"){const l=e.SN;E(u.cfg,d,l)}}y.value=!1},g=Q,A=v(""),oe=()=>{const e=o.value,s=`setDisabled_${e.uuid}_${e.fullKey}`,n=`setHidden_${e.uuid}_${e.fullKey}`,d=`setColumnHidden_${e.uuid}_${e.fullKey}`,l=`setRules_${e.uuid}_${e.fullKey}`,c=`autoActiveEvent_${e.uuid}_${e.fullKey}`,t=`setClose_${e.uuid}`;_.on(s,r=>{o.value.disabled=r,g("update:field",o.value)}),_.on(t,r=>{A.value=r}),_.on(n,r=>{o.value.hidden=r,g("update:field",o.value)}),_.on(d,r=>{o.value.hidden=r,g("update:field",o.value)}),_.on(l,r=>{o.value.rules=[r],g("update:field",o.value)}),_.on(c,r=>{x(u.cfg,m.value,u.formRow)})};return(e,s)=>{const n=Y("van-button"),d=Y("van-field");return I(),q("div",{class:Z(a(A))},[ue(H("div",null,[W(d,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=l=>m.value=l),readonly:"",name:a(o).bindModel,label:a(o).fieldLabel,placeholder:a(o).placeholder,disabled:a(o).disabled,required:a(o).required,rules:a(o).rules},{input:R(()=>[H("div",he,[a(o).fieldControlMode=="button"?(I(),U(n,{key:0,disabled:a(o).disabled,onClick:D,type:"default",size:"small"},{default:R(()=>[ce(G(a(o).fieldDisplayText),1)]),_:1},8,["disabled"])):z("",!0),a(o).fieldControlMode=="hyperlink"?(I(),q("span",{key:1,class:Z([{disabled:a(o).disabled}]),onClick:D},G(a(o).fieldDisplayText),3)):z("",!0)])]),button:R(()=>[W(ve,{field:a(o)},null,8,["field"])]),_:1},8,["modelValue","name","label","placeholder","disabled","required","rules"]),(I(),U(fe,{formId:a(M),formKey:a(F),bringMap:a(k),"form-view-model":a(C),formState:a($),appId:a(K),key:new Date().getTime(),show:a(y),onOnCancle:X,formName:a(N),onOnSave:ee},null,8,["formId","formKey","bringMap","form-view-model","formState","appId","show","formName"]))],512),[[de,!a(o).hidden]])],2)}}}),De=ge(ye,[["__scopeId","data-v-5af4ac2b"]]);export{De as default};
