import{d as I,L as C,W as O,M as B,m as h,c as F,o as W,x as Y,Q as b,l as Z,v as j,u as a,a as K,b as k,e as L,r as x,g as z,k as G,t as H}from"./main-BnXXyOo5.js";import{u as Q}from"./formWatch-KqHO0hI-.js";import"./useFormEnv-VwQXjqJl.js";import"./encodeext-DBC3bVZy.js";import"./useInitFieldState-EKN-2KHT.js";const q={class:""},te=I({__name:"YZGridTtreedsbtn",props:C({cfg:{},formRow:{},rowId:{}},{modelValue:{},modelModifiers:{}}),emits:C(["update:field"],["update:modelValue"]),setup(_,{emit:T}){const D=O(),{WatchSelfExpress:S}=Q(),V=B(_,"modelValue");h(V.value);const n=_,y=F(()=>D.getCurrentFormId),t=h(n.cfg),u=h(!1);W(async()=>{Y(()=>{P(),S(t.value,n.formRow,e=>{},e=>{t.value.hidden=e,c("update:field",t.value)},e=>{t.value.disabled=e,c("update:field",t.value)},e=>{})})});const $=()=>{n.cfg.disabled||(u.value=!0)},f=e=>{u.value=e},E=()=>{f(!1)},M=e=>{f(!1),N(e)},N=async e=>{const l=n.cfg;if(!l.ds)return;const s=l.ds.map,o=Object.keys(s),d={};o.forEach(m=>{const p=s[m];if(p.indexOf(".")>-1){const i=p.split(".")[0],w=p.split(".")[1];if(d[i]){let r=0;for(const v of e){const g=v.extend[m];d[i][r][w]=g,r++}}else{d[i]=[];for(const r of e){const v=r.extend[m],g={[w]:v};d[i].push(g)}}}}),f(!1);const R=`addRow_${y.value}_${n.rowId}`;b.emit(R,d)},c=T,P=()=>{const e=t.value,l=`setDisabled_${e.uuid}_${e.fullKey}`,s=`setHidden_${e.uuid}_${e.fullKey}`;b.on(l,o=>{t.value.disabled=o,c("update:field",t.value)}),b.on(s,o=>{t.value.hidden=o,c("update:field",t.value)})};return(e,l)=>{const s=x("van-button"),o=x("YZTreeDataDialog");return Z((z(),K("div",q,[k(s,{icon:"search",size:"small",block:"",onClick:$,disabled:a(t).disabled},{default:L(()=>[G(H(a(t).fieldLabel),1)]),_:1},8,["disabled"]),k(o,{showPicker:a(u),multiple:!0,currentCfg:e.cfg,title:a(t).dialogTitle,ds:a(t).ds,treeCfg:a(t).treeConfig,onOnSave:M,onOnCancel:E},null,8,["showPicker","currentCfg","title","ds","treeCfg"])],512)),[[j,!a(t).hidden]])}}});export{te as default};
