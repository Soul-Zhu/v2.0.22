import{d as j,m as n,o as G,x as H,c as J,p as K,K as y,a as u,b as _,e as F,i as w,u as d,r as x,H as O,J as Q,g as f,F as k,j as A,h as C,k as Y,t as I}from"./main-BnXXyOo5.js";import{u as Z}from"./appStore-vESM88W9.js";import{u as $}from"./encodeext-DBC3bVZy.js";import{A as V}from"./appurl-DnExzjDg.js";const q={class:""},te=j({__name:"YZAppFmsvrgrid",props:{appcfg:{},formRow:{}},setup(b){const{encode:B,encodeBase64:z}=$(),o=n(!1),m=n(!1),D=n(""),i=n(1),s=b;n(s.appcfg),G(()=>{H(async()=>{await U(),await h(),console.log("appcfg",s.appcfg)})});const M=J(()=>s.appcfg.gridSettingColumns);Z();const g=n([]),R=n(""),S=n(0),v=n(!1),U=async()=>{const a=s.appcfg.formSvr.fmid;D.value=a;const e=V.getAppFormId.url.toFetchUrl({params1:a}),{success:p,data:r,errorMessage:t}=await K(e);if(!p){y(t,"danger");return}R.value=r.formId},E=async a=>{v.value&&(g.value.length=0,v.value=!1);const e=L(s.appcfg.ds);await N(s.appcfg.ds,a,e)},L=a=>{const e=new FormData;if(!a){e.append("page",String(i.value)),e.append("limit",String(s.appcfg.pageSize));const t=(i.value-1)*s.appcfg.pageSize;return e.append("start",String(t)),e.append("o",""),e}e.append("page",String(i.value)),e.append("limit",String(s.appcfg.pageSize));const p=(i.value-1)*s.appcfg.pageSize;e.append("start",String(p)),e.append("o","");const r={};return a.filter&&Object.keys(a.filter).forEach(t=>{const l=a.filter[t];r[t]={op:l.op,value:l.type==="const"?l.value:""}}),e.append("f",z(B(r))),e},N=async(a,e,p)=>{if(a&&a.type===O.app){const r=V.getAppFormPage.url.toFetchUrl({params1:e}),{success:t,errorMessage:l,data:c}=await Q(r,p);if(!t){y(l,"danger");return}S.value=c.total,(c.children.length<=0||S.value===g.value.length)&&(m.value=!0),o.value=!1,g.value.push(...c.children),i.value+=1}},P=()=>{i.value=1,m.value=!1,v.value=!0,o.value=!0,h()},h=async()=>{const a=s.appcfg.formSvr.fmid;await E(a)};return(a,e)=>{const p=x("van-list"),r=x("van-pull-refresh");return f(),u("div",q,[_(r,{modelValue:d(o),"onUpdate:modelValue":e[1]||(e[1]=t=>w(o)?o.value=t:null),onRefresh:P},{default:F(()=>[_(p,{loading:d(o),"onUpdate:loading":e[0]||(e[0]=t=>w(o)?o.value=t:null),finished:d(m),"finished-text":"没有更多了","immediate-check":!1,onLoad:h},{default:F(()=>[(f(!0),u(k,null,A(d(g),(t,l)=>(f(),u("div",{class:"app-grid-card",key:l},[(f(!0),u(k,null,A(d(M),(c,T)=>(f(),u("div",{class:"app-grid-row",key:T},[C("p",null,[Y(I(c.text)+": ",1),C("span",null,I(t[c.$bind]),1)])]))),128))]))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])}}});export{te as default};
