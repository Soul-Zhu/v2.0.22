import{d as P,m as r,$ as C,o as x,x as V,Q as k,aI as w,r as y,a as c,g as p,b as v,e as g,u as l,i as T,F as b,j as A,aQ as M,n as R,h as B,t as F,aR as Q,p as U,q as Y,K as q}from"./main-BnXXyOo5.js";import{T as E}from"./TaskCard-DN6TrCgP.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={key:0,class:"step-name"},W={class:"status-div"},$=P({__name:"TaskComplete",setup(j){const a=r(!1),i=r(!1),d=r(!1),t=C({page:1,start:0,limit:10,byYear:1,Year:new Date().getFullYear(),historyTaskType:"MyProcessed"}),D=r(0),o=r([]),u=async()=>{a.value&&(a.value=!1,o.value.length=0),t.start=(t.page-1)*t.limit;const e={...t,..._.value},{success:n,errorMessage:f,data:m}=await U(Y.getRequstTask.url,e);if(!n){q(f,"danger");return}const{total:s,children:I}=m,h=I;D.value=s,e.page==1&&(o.value=[]),o.value.push(...h),(o.value.length>=s||h.length<=0)&&(d.value=!0),t.page+=1,i.value=!1},N=e=>({ProcessId:e.ProcessId,ProcessName:e.ProcessName,ProcessVersion:e.ProcessVersion,ProcessIcon:e.ProcessIcon,SerialNum:e.SerialNum,CreateAt:e.CreateAt,Description:e.Description,OwnerDisplayName:e.OwnerDisplayName,AgentDisplayName:e.AgentDisplayName,TaskID:e.TaskID,StepID:e.StepID}),S=()=>{a.value=!0,t.page=1,u()},_=r({});return x(()=>{u(),V(()=>{k.on("onTask_complete",e=>{_.value=e.value,t.page=1,a.value=!0,d.value=!1,o.value.length=0,u()})})}),w(()=>{k.off("onTask_complete")}),(e,n)=>{const f=y("van-list"),m=y("van-pull-refresh");return p(),c("div",null,[v(m,{modelValue:l(a),"onUpdate:modelValue":n[1]||(n[1]=s=>T(a)?a.value=s:null),onRefresh:S},{default:g(()=>[v(f,{loading:l(i),"onUpdate:loading":n[0]||(n[0]=s=>T(i)?i.value=s:null),finished:l(d),"immediate-check":!1,"finished-text":e.$t("Work.NoMore"),onLoad:u},{default:g(()=>[(p(!0),c(b,null,A(l(o),s=>(p(),c("div",{key:s.ProcessId},[v(E,{process:N(s),"task-type":l(M).READ},{default:g(()=>[s.State&&s.State.children?(p(),c("div",O,[B("div",W,F(l(Q)[s.State.State]),1)])):R("",!0)]),_:2},1032,["process","task-type"])]))),128))]),_:1},8,["loading","finished","finished-text"])]),_:1},8,["modelValue"])])}}}),H=L($,[["__scopeId","data-v-02c101c3"]]);export{H as default};
